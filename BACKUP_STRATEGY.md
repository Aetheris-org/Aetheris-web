# üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è OAuth callback

–ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å:

## –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ middleware

–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `backend/strapi-backend/src/middlewares/oauth-redirect.ts`:

```typescript
export default (config, { strapi }) => {
  return async (ctx, next) => {
    // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ OAuth callback
    if (ctx.path === '/api/connect/google/callback' || ctx.path.match(/^\/api\/connect\/\w+\/callback$/)) {
      console.log('üîµ Middleware: Intercepted OAuth callback');
      
      // –í—ã–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
      await next();
      
      // –ï—Å–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç —É–∂–µ –ø—Ä–æ–∏–∑–æ—à—ë–ª, –Ω–µ –¥–µ–ª–∞–µ–º –Ω–∏—á–µ–≥–æ
      if (ctx.status === 302 || ctx.status === 301) {
        console.log('üîµ Middleware: Redirect already happened, checking URL...');
        
        // –ü–æ–ª—É—á–∞–µ–º URL –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Location
        const redirectUrl = ctx.response.get('Location');
        console.log(`üîµ Middleware: Original redirect URL: ${redirectUrl}`);
        
        // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç Strapi (–±–µ–∑ —Ç–æ–∫–µ–Ω–∞), –Ω—É–∂–Ω–æ –µ–≥–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å
        // –ù–æ —ç—Ç–æ —Å–ª–æ–∂–Ω–æ, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç 2
      }
    } else {
      await next();
    }
  };
};
```

## –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π callback –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ

–ï—Å–ª–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ:

1. –û—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Strapi callback (–æ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/auth/local?access_token=...`)
2. –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å —ç—Ç–æ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç
3. –ò–∑–≤–ª–µ—á—å —Ç–æ–∫–µ–Ω –∏–∑ URL –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å

–ù–æ —ç—Ç–æ –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π callback –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

## –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π endpoint

–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint `/api/auth/google/callback` –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Google OAuth –Ω–∞ —ç—Ç–æ—Ç URL –≤–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ.

---

**–¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å.** –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Strapi –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.


