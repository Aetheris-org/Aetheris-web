Текущее бэкенд-устройство (коротко и по делу):

1) Архитектура
- Отдельного Node/Express сервера больше нет: фронтенд ходит напрямую в Supabase.
- Основные сервисы Supabase: Postgres + RLS, Auth, Storage, SQL Functions/RPC, Triggers.
- Клиент: `@supabase/supabase-js` с `VITE_SUPABASE_URL` и `VITE_SUPABASE_ANON_KEY`; сессия хранится в Supabase Auth (JWT, auto-refresh, persistSession=true).

2) Данные (публичная схема)
- profiles: id (UUID из auth.users), username, name, bio, avatar/cover, tag, counters.
- articles: id (UUID/num), title, content (JSONB/HTML), excerpt, tags[], difficulty, preview_image, likes_count, dislikes_count, views, published_at, author_id (FK profiles).
- comments: id, text/content, article_id, author_id, parent_id, likes_count, dislikes_count.
- article_reactions / comment_reactions: (article_id|comment_id, user_id, reaction like|dislike), агрегаты дублируются в статьях/комментах.
- bookmarks: (user_id, article_id).
- follows: follower_id, following_id.
- notifications: user_id, type, actor_id, article_id?, comment_id?, is_read, metadata JSON.
- (В Supabase есть служебные auth.users; профиль создаётся триггером при регистрации.)

3) Основные RPC/функции
- search_articles(p_search, p_tags, p_difficulty, p_sort, p_skip, p_take, p_user_id) — полнотекстовый поиск + пагинация, возвращает author JSON и user_reaction.
- get_article_with_details(p_article_id, p_user_id, p_increment_views) — статья + author JSON + user_reaction, опционально инкрементирует просмотры.
- toggle_article_reaction / toggle_bookmark / toggle_follow — атомарные переключатели с возвратом итогового состояния.

4) Потоки аутентификации
- Email/пароль через Supabase Auth; восстановление пароля через `resetPasswordForEmail`.
- OAuth (Google/GitHub) через Supabase; redirectTo: `${window.location.origin}/auth/callback` (см. `OAUTH_SETUP.md`).
- После signup профиль в `public.profiles` создаётся триггером по вставке в auth.users.

5) Безопасность и политики
- RLS включён: записи статей/комментариев/реакций/закладок/подписок редактирует только владелец; чтение публичных данных разрешено; проверки делаются в БД.
- Storage: публичный bucket `images`; политики — SELECT всем, INSERT только аутентифицированным, DELETE только владельцу файла (см. `SUPABASE_STORAGE_SETUP.md`).
- Auth токены хранятся в httpOnly недоступных куках у провайдера Supabase; фронт использует встроенные refresh/expire механизмы.
- Валидации на клиенте: длины title/excerpt, форматы UUID, уникальность tag, ограничения по символам.
- Ошибки БД мапятся по кодам (например, PGRST116 not found, 23505 unique violation).

6) Интеграция фронта
- Все запросы идут через Supabase REST/RPC из `frontend-react/src/api/*.ts`.
- CRUD по таблицам, выборки с join-ами через foreign key (например, `author:profiles!articles_author_id_fkey`).
- Аггрегации лайков/дизлайков пересчитываются после upsert реакций и пишутся обратно в базу.
- Вьюхи статей инкрементируются через RPC (p_increment_views=true).

7) Хранилище файлов
- Bucket `images`, структура по папкам avatars/{user}, covers/{user}, articles/{user}.
- Обязательные переменные: `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`; для загрузок нужны настроенные RLS политики и публичный bucket.

Краткое резюме: бэкенд — это Supabase (Postgres+RLS+Auth+Storage+RPC). Фронт работает напрямую через supabase-js, использует типизированные таблицы и несколько RPC для поиска/деталей/тогглов. Без отдельного сервера: вся авторизация, бизнес-логика (поиск, счётчики, триггеры) и безопасность живут внутри Supabase.

