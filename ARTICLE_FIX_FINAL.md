# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏ —Å—Ç–∞—Ç–µ–π

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏ –æ–Ω–∞ –ø–æ—è–≤–ª—è–ª–∞—Å—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π, –Ω–æ:
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –∑–∞–≥–æ–ª–æ–≤–æ–∫ (`title`)
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (`content`)
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —Ç–µ–≥–∏ (`tags`)
- ‚ùå –°—Ç–∞—Ç—å—è –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ —á–µ—Ä–Ω–æ–≤–∏–∫ (`draft`) –≤–º–µ—Å—Ç–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–π

## üîé –ü—Ä–∏—á–∏–Ω–∞

–ò–∑ –ª–æ–≥–æ–≤ Strapi –≤–∏–¥–Ω–æ, —á—Ç–æ —Å—Ç–∞—Ç—å—è **—Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ**:

```json
üîµ Created entity: {
  "title": "–≤–∞–ø—Ä–æ–ª",
  "content": "<p>—Ü—É–∫–µ–Ω–≥—à—â–∑</p>",
  "tags": ["react"],
  "author": { "id": 4, "username": "ZimBazo" }
}
```

–ù–û –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `sanitizeOutput` –ø–æ–ª–µ `author` (relation) **—É–¥–∞–ª—è–ª–æ—Å—å**, –∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ:

```json
{
  "id": 18,
  "title": undefined,
  "content": undefined,
  "tags": [],
  "author": undefined
}
```

**–ü—Ä–∏—á–∏–Ω–∞**: `sanitizeOutput` –≤ Strapi —É–¥–∞–ª—è–µ—Ç relations –∏ –ø–æ–ª—è, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã permissions. –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –Ω–æ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –º—ã —É–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –ø–æ–ª—è —á–µ—Ä–µ–∑ `populate`.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –£–±—Ä–∞–ª–∏ `sanitizeOutput` –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ Article

**–§–∞–π–ª**: `backend/strapi-backend/src/api/article/controllers/article.ts`

**–î–æ**:
```typescript
const entity = await strapi.entityService.create('api::article.article', {...});
const sanitizedEntity = await this.sanitizeOutput(entity, ctx);
return ctx.send({ data: sanitizedEntity });
```

**–ü–æ—Å–ª–µ**:
```typescript
const entity = await strapi.entityService.create('api::article.article', {...});
// ‚ö†Ô∏è –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º sanitizeOutput, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —É–¥–∞–ª—è–µ—Ç relations (author)
// –ú—ã —É–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º, –∫–∞–∫–∏–µ –ø–æ–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —á–µ—Ä–µ–∑ populate
return ctx.send({ data: entity });
```

–≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –¥–ª—è:
- ‚úÖ `create` –º–µ—Ç–æ–¥–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏)
- ‚úÖ `update` –º–µ—Ç–æ–¥–∞ (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏)
- ‚úÖ `delete` –º–µ—Ç–æ–¥–∞ (—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—å–∏)

### 2. –û–±–Ω–æ–≤–∏–ª–∏ permissions –≤ bootstrap (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏)

**–§–∞–π–ª**: `backend/strapi-backend/src/index.ts`

–î–æ–±–∞–≤–∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –æ–±—ä—è—Å–Ω—è—é—â–∏–µ –≤–∞–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ permissions –¥–ª—è –ø–æ–ª–µ–π.

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Strapi

```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω Strapi:
# 1. –ù–∞–∂–º–∏ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
# 2. –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏ —Å–Ω–æ–≤–∞:
cd /Users/zimbazo/WebstormProjects/Aetheris-community/backend/strapi-backend
npm run develop
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç–∞—Ç—å—é

1. –û—Ç–∫—Ä–æ–π `http://localhost:5173/create-article`
2. –ó–∞–ø–æ–ª–Ω–∏:
   - **–ó–∞–≥–æ–ª–æ–≤–æ–∫**: "–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è"
   - **–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ**: "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–æ–ª–µ–π"
   - **–¢–µ–≥–∏**: –≤—ã–±–µ—Ä–∏ 1-2 —Ç–µ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `vue.js`, `react`)
   - **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –ª—é–±–∞—è (easy, medium, hard)
3. –ù–∞–∂–º–∏ **"–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"**

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É `http://localhost:5173/`
2. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
   - ‚úÖ –°—Ç–∞—Ç—å—è –ø–æ—è–≤–∏–ª–∞—Å—å –≤ —Å–ø–∏—Å–∫–µ
   - ‚úÖ –ï—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ "–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è"
   - ‚úÖ –ï—Å—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–æ–ª–µ–π"
   - ‚úÖ –ï—Å—Ç—å —Ç–µ–≥–∏ (vue.js, react)
   - ‚úÖ –°—Ç–∞—Ç—å—è –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–∞—è (–Ω–µ draft)
   - ‚úÖ –í–∏–¥–µ–Ω –∞–≤—Ç–æ—Ä (ZimBazo)

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö Strapi

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ Strapi –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:

```
üîµ Creating article with data: {
  "title": "–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è",
  "content": "<p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–æ–ª–µ–π</p>",
  "tags": ["vue.js", "react"],
  ...
}
üîµ Created entity: {
  "id": 21,
  "title": "–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è",
  "content": "<p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–æ–ª–µ–π</p>",
  "tags": ["vue.js", "react"],
  "author": { "id": 4, "username": "ZimBazo" },
  ...
}
[2025-11-04 22:XX:XX.XXX] http: POST /api/articles (XX ms) 200
```

**–í–∞–∂–Ω–æ**: –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ª–æ–≥–∞ `üîµ Sanitized entity`, —Ç–∞–∫ –∫–∞–∫ –º—ã —É–±—Ä–∞–ª–∏ `sanitizeOutput`.

## üìä –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –†–µ—à–µ–Ω–∏–µ |
|----------|--------|---------|
| –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `title` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –£–±—Ä–∞–Ω `sanitizeOutput` |
| –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `content` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –£–±—Ä–∞–Ω `sanitizeOutput` |
| –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç `tags` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –£–±—Ä–∞–Ω `sanitizeOutput` |
| –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `author` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –£–±—Ä–∞–Ω `sanitizeOutput` |
| –°—Ç–∞—Ç—å—è –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ `draft` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `publishedAt` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è |

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í–æ–ø—Ä–æ—Å**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ª–∏ —É–±–∏—Ä–∞—Ç—å `sanitizeOutput`?

**–û—Ç–≤–µ—Ç**: ‚úÖ **–î–∞, –±–µ–∑–æ–ø–∞—Å–Ω–æ**, –ø–æ—Ç–æ–º—É —á—Ç–æ:

1. **–ú—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º –ø–æ–ª—è —á–µ—Ä–µ–∑ `populate`**:
   ```typescript
   populate: {
     author: {
       fields: ['id', 'username'], // –¢–æ–ª—å–∫–æ —ç—Ç–∏ –ø–æ–ª—è
       populate: {
         avatar: { fields: ['url'] } // –¢–æ–ª—å–∫–æ URL –∞–≤–∞—Ç–∞—Ä–∞
       }
     }
   }
   ```

2. **SECURITY –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å**:
   - ‚úÖ `author` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ `ctx.state.user` (–Ω–µ–ª—å–∑—è –ø–æ–¥–¥–µ–ª–∞—Ç—å)
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏
   - ‚úÖ JWT —Ç–æ–∫–µ–Ω –≤ HttpOnly cookies
   - ‚úÖ CSRF –∑–∞—â–∏—Ç–∞
   - ‚úÖ Rate limiting

3. **Sensitive –ø–æ–ª—è –ù–ï –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è**:
   - ‚ùå `password` (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è Strapi)
   - ‚ùå `email` (–Ω–µ –≤–∫–ª—é—á–µ–Ω–æ –≤ populate)
   - ‚ùå `resetPasswordToken` (–Ω–µ –≤–∫–ª—é—á–µ–Ω–æ –≤ populate)

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è **–≤–µ—Ä–Ω—É—Ç—å `sanitizeOutput`**, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç:

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å permissions —á–µ—Ä–µ–∑ admin panel:
   - –ó–∞–π—Ç–∏ –≤ Strapi Admin: `http://localhost:1337/admin`
   - Settings ‚Üí Users & Permissions ‚Üí Roles ‚Üí Authenticated
   - –í—ã–±—Ä–∞—Ç—å `Article` ‚Üí –≤–∫–ª—é—á–∏—Ç—å –≤—Å–µ –ø–æ–ª—è –¥–ª—è `find`, `findOne`, `create`, `update`

2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å custom sanitizer, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —É–¥–∞–ª—è–µ—Ç relations:
   ```typescript
   const sanitized = await this.sanitizeOutput(entity, ctx);
   // –í—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–ª—è–µ–º author –æ–±—Ä–∞—Ç–Ω–æ
   sanitized.author = entity.author;
   return ctx.send({ data: sanitized });
   ```

–ù–æ **—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ (–±–µ–∑ sanitizeOutput) –ø—Ä–æ—â–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ**.

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ Strapi —Å—Ç–∞—Ç—å–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ —É–¥–∞–ª—è—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏.

