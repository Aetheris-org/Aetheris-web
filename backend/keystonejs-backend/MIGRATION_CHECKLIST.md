# Чеклист миграции на Supabase

Используйте этот чеклист для пошаговой миграции проекта на Supabase.

## Подготовка

- [ ] Создан проект на Supabase
- [ ] Получены все необходимые ключи (URL, Anon Key, Service Role Key, Database URL)
- [ ] Создан `.env` файл с переменными окружения
- [ ] Установлены зависимости (`npm install`)

## Миграции базы данных

- [ ] Выполнена миграция `001_initial_schema.sql` в Supabase SQL Editor
- [ ] Выполнена миграция `002_sync_profiles_with_auth_users.sql`
- [ ] Выполнена миграция `003_row_level_security.sql`
- [ ] Проверено, что все таблицы созданы корректно
- [ ] Проверено, что триггеры работают

## Настройка Supabase

- [ ] Настроен `EMAIL_HMAC_SECRET` в Supabase
- [ ] Включены провайдеры аутентификации (Email, Google OAuth)
- [ ] Настроены redirect URLs для OAuth
- [ ] Включен Row Level Security (RLS)

## Тестирование

- [ ] Backend запускается без ошибок
- [ ] Подключение к Supabase PostgreSQL работает
- [ ] GraphQL API отвечает корректно
- [ ] Регистрация нового пользователя создает профиль автоматически
- [ ] OAuth аутентификация работает
- [ ] RLS политики работают корректно

## Миграция данных (если есть существующие данные)

- [ ] Экспортированы данные из старой БД
- [ ] Созданы пользователи в Supabase Auth
- [ ] Импортированы профили в `public.profiles`
- [ ] Обновлены внешние ключи в других таблицах
- [ ] Проверена целостность данных

## Frontend (если нужно)

- [ ] Установлен `@supabase/supabase-js` на frontend
- [ ] Настроены переменные окружения на frontend
- [ ] Обновлены API клиенты для работы с Supabase Auth
- [ ] Протестирована аутентификация на frontend

## Production

- [ ] Обновлены переменные окружения для production
- [ ] Настроены production redirect URLs в Supabase
- [ ] Проверена безопасность (RLS, секреты)
- [ ] Настроен мониторинг и логирование
- [ ] Создан backup базы данных

## Документация

- [ ] Обновлена документация проекта
- [ ] Обновлены README файлы
- [ ] Задокументированы изменения в API (если есть)

## Откат (если нужно)

- [ ] Создан backup старой базы данных
- [ ] Задокументирован процесс отката
- [ ] Протестирован процесс отката на тестовой среде


