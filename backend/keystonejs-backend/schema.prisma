// This file is automatically generated by Keystone, do not modify it manually.
// Modify your Keystone config when you want to change this.

datasource sqlite {
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  provider          = "sqlite"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                      Int               @id @default(autoincrement())
  name                    String            @default("")
  email                   String            @unique @default("")
  password                String?
  username                String            @unique @default("")
  bio                     String            @default("")
  avatar                  String            @default("")
  coverImage              String            @default("")
  provider                String?           @default("local")
  confirmed               Boolean           @default(false)
  blocked                 Boolean           @default(false)
  role                    String            @default("user")
  articles                Article[]         @relation("Article_author")
  comments                Comment[]         @relation("Comment_author")
  articleReactions        ArticleReaction[] @relation("ArticleReaction_user")
  commentReactions        CommentReaction[] @relation("CommentReaction_user")
  bookmarks               Bookmark[]        @relation("Bookmark_user")
  following               Follow[]          @relation("Follow_follower")
  followers               Follow[]          @relation("Follow_following")
  notifications           Notification[]    @relation("Notification_user")
  createdAt               DateTime?         @default(now())
  updatedAt               DateTime?         @default(now())
  passwordResetToken      String?
  passwordResetIssuedAt   DateTime?
  passwordResetRedeemedAt DateTime?
  magicAuthToken          String?
  magicAuthIssuedAt       DateTime?
  magicAuthRedeemedAt     DateTime?
  from_Notification_actor Notification[]    @relation("Notification_actor")
}

model Article {
  id                        Int               @id @default(autoincrement())
  title                     String            @default("")
  content                   String            @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  excerpt                   String            @default("")
  author                    User?             @relation("Article_author", fields: [authorId], references: [id])
  authorId                  Int?              @map("author")
  tags                      String?
  difficulty                String            @default("medium")
  previewImage              String            @default("")
  likes_count               Int?              @default(0)
  dislikes_count            Int?              @default(0)
  views                     Int?              @default(0)
  comments                  Comment[]         @relation("Comment_article")
  reactions                 ArticleReaction[] @relation("ArticleReaction_article")
  bookmarks                 Bookmark[]        @relation("Bookmark_article")
  publishedAt               DateTime?
  createdAt                 DateTime?         @default(now())
  updatedAt                 DateTime?         @default(now())
  from_Notification_article Notification[]    @relation("Notification_article")

  @@index([title])
  @@index([authorId])
}

model Comment {
  id                        Int               @id @default(autoincrement())
  text                      String            @default("")
  article                   Article?          @relation("Comment_article", fields: [articleId], references: [id])
  articleId                 Int?              @map("article")
  author                    User?             @relation("Comment_author", fields: [authorId], references: [id])
  authorId                  Int?              @map("author")
  parent                    Comment?          @relation("Comment_parent", fields: [parentId], references: [id])
  parentId                  Int?              @map("parent")
  likes_count               Int?              @default(0)
  dislikes_count            Int?              @default(0)
  reactions                 CommentReaction[] @relation("CommentReaction_comment")
  createdAt                 DateTime?         @default(now())
  updatedAt                 DateTime?         @default(now())
  from_Comment_parent       Comment[]         @relation("Comment_parent")
  from_Notification_comment Notification[]    @relation("Notification_comment")

  @@index([articleId])
  @@index([authorId])
  @@index([parentId])
}

model ArticleReaction {
  id        Int       @id @default(autoincrement())
  article   Article?  @relation("ArticleReaction_article", fields: [articleId], references: [id])
  articleId Int?      @map("article")
  user      User?     @relation("ArticleReaction_user", fields: [userId], references: [id])
  userId    Int?      @map("user")
  reaction  String
  createdAt DateTime? @default(now())

  @@index([articleId])
  @@index([userId])
}

model CommentReaction {
  id        Int       @id @default(autoincrement())
  comment   Comment?  @relation("CommentReaction_comment", fields: [commentId], references: [id])
  commentId Int?      @map("comment")
  user      User?     @relation("CommentReaction_user", fields: [userId], references: [id])
  userId    Int?      @map("user")
  reaction  String
  createdAt DateTime? @default(now())

  @@index([commentId])
  @@index([userId])
}

model Bookmark {
  id        Int       @id @default(autoincrement())
  user      User?     @relation("Bookmark_user", fields: [userId], references: [id])
  userId    Int?      @map("user")
  article   Article?  @relation("Bookmark_article", fields: [articleId], references: [id])
  articleId Int?      @map("article")
  createdAt DateTime? @default(now())

  @@index([userId])
  @@index([articleId])
}

model Follow {
  id          Int       @id @default(autoincrement())
  follower    User?     @relation("Follow_follower", fields: [followerId], references: [id])
  followerId  Int?      @map("follower")
  following   User?     @relation("Follow_following", fields: [followingId], references: [id])
  followingId Int?      @map("following")
  createdAt   DateTime? @default(now())

  @@index([followerId])
  @@index([followingId])
}

model Notification {
  id        Int       @id @default(autoincrement())
  user      User?     @relation("Notification_user", fields: [userId], references: [id])
  userId    Int?      @map("user")
  type      String
  actor     User?     @relation("Notification_actor", fields: [actorId], references: [id])
  actorId   Int?      @map("actor")
  article   Article?  @relation("Notification_article", fields: [articleId], references: [id])
  articleId Int?      @map("article")
  comment   Comment?  @relation("Notification_comment", fields: [commentId], references: [id])
  commentId Int?      @map("comment")
  isRead    Boolean   @default(false)
  readAt    DateTime?
  metadata  String?
  createdAt DateTime? @default(now())

  @@index([userId])
  @@index([type])
  @@index([actorId])
  @@index([articleId])
  @@index([commentId])
  @@index([createdAt])
}
