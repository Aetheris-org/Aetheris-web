# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç - OAuth2 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

## ‚ö° –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. ‚úÖ **–°–æ–∑–¥–∞–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π OAuth –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å —Ç–æ–∫–µ–Ω–æ–º
2. ‚úÖ **–£–ø—Ä–æ—â—ë–Ω Auth.vue** - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `redirectUrl`
3. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ AuthCallback –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
4. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã** - –±–æ–ª—å—à–µ –Ω–µ –ø—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–π `/login`

---

## üîß –û—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å (5 –º–∏–Ω—É—Ç):

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ Strapi

**–≠—Ç–æ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û** - –±–µ–∑ —ç—Ç–æ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!

1. –û—Ç–∫—Ä–æ–π http://localhost:1337/admin
2. –í–æ–π–¥–∏ —Å admin –ª–æ–≥–∏–Ω–æ–º (–∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Å–æ–∑–¥–∞–≤–∞–ª –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Strapi)
3. –ü–µ—Ä–µ–π–¥–∏: **Settings** (‚öôÔ∏è —Å–ª–µ–≤–∞ –≤–Ω–∏–∑—É) ‚Üí **USERS & PERMISSIONS PLUGIN** ‚Üí **Roles**

#### –†–æ–ª—å "Public" (–¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö):

–ö–ª–∏–∫–Ω–∏ –Ω–∞ **Public** ‚Üí –ø—Ä–æ–∫—Ä—É—Ç–∏ –≤–Ω–∏–∑ –¥–æ —Ä–∞–∑–¥–µ–ª–∞ **Permissions**:

–í —Ä–∞–∑–¥–µ–ª–µ **Users-permissions** –ø–æ—Å—Ç–∞–≤—å –≥–∞–ª–æ—á–∫–∏:
- ‚úÖ `connect` - –¥–ª—è OAuth –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ `callback` - –¥–ª—è OAuth callback

**–ù–∞–∂–º–∏ "Save"** (—Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É)

#### –†–æ–ª—å "Authenticated" (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö):

–ö–ª–∏–∫–Ω–∏ –Ω–∞ **Authenticated** ‚Üí –ø—Ä–æ–∫—Ä—É—Ç–∏ –≤–Ω–∏–∑ –¥–æ —Ä–∞–∑–¥–µ–ª–∞ **Permissions**:

–í —Ä–∞–∑–¥–µ–ª–µ **Users-permissions** –ø–æ—Å—Ç–∞–≤—å –≥–∞–ª–æ—á–∫–∏:
- ‚úÖ `me` - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö (`GET /api/users/me`)
- ‚úÖ `find` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ `findOne` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π

**–ù–∞–∂–º–∏ "Save"** (—Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É)

---

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å Google OAuth –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. –í Strapi Admin ‚Üí **Settings** ‚Üí **USERS & PERMISSIONS PLUGIN** ‚Üí **Providers**
2. –ù–∞–π–¥–∏ **Google**
3. –£–±–µ–¥–∏—Å—å:
   - ‚úÖ **Enabled**: `ON` (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å–ø—Ä–∞–≤–∞)
   - ‚úÖ **Client ID**: –ó–∞–ø–æ–ª–Ω–µ–Ω
   - ‚úÖ **Client Secret**: –ó–∞–ø–æ–ª–Ω–µ–Ω
   - ‚úÖ **The redirect URL to add in your Google application configurations**: 
     ```
     http://localhost:1337/api/connect/google/callback
     ```

**–ù–∞–∂–º–∏ "Save"**

---

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä—É–π!

1. –û—Ç–∫—Ä–æ–π http://localhost:5173
2. –ü–æ–ø—Ä–æ–±—É–π –∑–∞–π—Ç–∏ –Ω–∞ –ª—é–±—É—é –∑–∞—â–∏—â—ë–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (–Ω–∞–ø—Ä–∏–º–µ—Ä `/profile`)
3. –¢–µ–±—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ **/auth**
4. –ù–∞–∂–º–∏ **"–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å Google"**
5. –í—ã–±–µ—Ä–∏ –∞–∫–∫–∞—É–Ω—Ç Google
6. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
   - –ï—Å–ª–∏ —É —Ç–µ–±—è –Ω–µ—Ç –Ω–∏–∫–Ω–µ–π–º–∞ ‚Üí –ø–æ–ø–∞–¥—ë—à—å –Ω–∞ `/auth/finalize`
   - –ï—Å–ª–∏ –Ω–∏–∫–Ω–µ–π–º —É–∂–µ –µ—Å—Ç—å ‚Üí –ø–æ–ø–∞–¥—ë—à—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É `/`

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞: "–¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω"

**–û—Ç–∫—Ä–æ–π DevTools ‚Üí Console** –∏ –ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –≤—ã–≤–æ–¥:
- –ï—Å–ª–∏ –≤–∏–¥–∏—à—å `No access token in URL params: ?code=...` - –∑–Ω–∞—á–∏—Ç callback –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ Strapi Admin –≤–∫–ª—é—á–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–ª—è —Ä–æ–ª–∏ **Public**: `connect` –∏ `callback`

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to fetch user: 401"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ –≤–∫–ª—é—á–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–ª—è —Ä–æ–ª–∏ **Authenticated**

**–†–µ—à–µ–Ω–∏–µ**:
1. –ó–∞–π–¥–∏ –≤ Strapi Admin ‚Üí Settings ‚Üí Roles ‚Üí Authenticated
2. –í–∫–ª—é—á–∏ `me` (GET) –≤ —Ä–∞–∑–¥–µ–ª–µ Users-permissions
3. –°–æ—Ö—Ä–∞–Ω–∏

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∏–∫–Ω–µ–π–º"

**–†–µ—à–µ–Ω–∏–µ**: –ö–∞—Å—Ç–æ–º–Ω—ã–π endpoint `/api/users/me` (PUT) —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å –≤ DevTools ‚Üí Network, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –∏–¥—ë—Ç –Ω–∞ `/api/users/me` (–Ω–µ `/api/users/:id`)
2. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –µ—Å—Ç—å `Authorization: Bearer <token>`
3. –ü–æ—Å–º–æ—Ç—Ä–∏ –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –≤ Network tab

---

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏):

```
1. User –Ω–∞–∂–∏–º–∞–µ—Ç "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google" –Ω–∞ /auth
   ‚Üì
2. window.location.href = "http://localhost:1337/api/connect/google"
   ‚Üì
3. Strapi —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ Google OAuth
   ‚Üì
4. Google ‚Üí User logs in ‚Üí Redirect back to Strapi
   ‚Üì
5. Strapi callback: /api/connect/google/callback?code=xxx
   ‚Üì
6. –ö–∞—Å—Ç–æ–º–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä auth.ts:
   - –ü–æ–ª—É—á–∞–µ—Ç access_token –æ—Ç Google
   - –°–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Strapi
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω
   - –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞: http://localhost:5173/auth/callback?access_token=JWT
   ‚Üì
7. AuthCallback.vue:
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç access_token –∏–∑ URL
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ localStorage
   - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç GET /api/users/me
   - –ï—Å–ª–∏ username –ø—É—Å—Ç–æ–π ‚Üí /auth/finalize
   - –ï—Å–ª–∏ username –µ—Å—Ç—å ‚Üí /
   ‚Üì
8. AuthFinalize.vue (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
   - User –≤–≤–æ–¥–∏—Ç –Ω–∏–∫–Ω–µ–π–º
   - PUT /api/users/me { username: "..." }
   - –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /
```

---

## üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:

**Backend (Strapi):**
- `src/extensions/users-permissions/controllers/auth.ts` - –∫–∞—Å—Ç–æ–º–Ω—ã–π OAuth callback
- `src/extensions/users-permissions/controllers/user.ts` - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `src/extensions/users-permissions/routes/custom-auth.ts` - —Ä–æ—É—Ç –¥–ª—è OAuth
- `src/extensions/users-permissions/routes/custom-user.ts` - —Ä–æ—É—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è

**Frontend (Vue):**
- `src/views/Auth.vue` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `src/views/AuthCallback.vue` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ OAuth callback
- `src/views/AuthFinalize.vue` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∏–∫–Ω–µ–π–º–∞

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

- [ ] Strapi –∑–∞–ø—É—â–µ–Ω (`npm run dev` –≤ `backend/strapi-backend`)
- [ ] Frontend –∑–∞–ø—É—â–µ–Ω (`npm run dev` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)
- [ ] –í Strapi Admin –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–ª—è —Ä–æ–ª–∏ **Public**: `connect`, `callback`
- [ ] –í Strapi Admin –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–ª—è —Ä–æ–ª–∏ **Authenticated**: `me`
- [ ] –í Strapi Admin –≤–∫–ª—é—á–µ–Ω Google –ø—Ä–æ–≤–∞–π–¥–µ—Ä (Enabled = ON)
- [ ] Google Client ID –∏ Secret –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤ `.env`
- [ ] Redirect URL –≤ Google Console: `http://localhost:1337/api/connect/google/callback`

---

**–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ - —Ç–µ—Å—Ç–∏—Ä—É–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é! üöÄ**

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø–æ—Å–º–æ—Ç—Ä–∏ –≤ **Browser Console** (DevTools) –∏ –≤ **Strapi logs** (—Ç–µ—Ä–º–∏–Ω–∞–ª).

