import{d as Ce,u as Le,D as Re,c as Ae,r as m,e as V,L as je,w as z,a as Te,o as xe,f as Ee,i as c,E as r,F as se,j as e,k as K,M as Se,m as O,l as y,N as Be,t as f,s as ke,A as ye,y as G,T as be,v as le,O as $e,B as ge,q as Ie,H as Ve,z as De,I as He,_ as we,K as Oe,p as Ue,n as Me,C as Fe,G as he,g as Ze}from"./index-Cha8mMNk.js";import{F as Ke}from"./FullArticleCard-0H59Q-Oh.js";import{u as Ne,a as Pe}from"./articles-Cl6OgbpY.js";import{S as qe}from"./SharePanel-CYrpQnVO.js";import{u as ze}from"./DeleteConfirmDialog-CrHiTmEy.js";import"./index-CIrCQqjO.js";const We={class:"comment-header"},Ge={class:"user-info"},Je={class:"user-name-row"},Qe={class:"username-with-badge"},Xe={key:0,class:"self-badge"},Ye={class:"comment-meta"},_e={class:"comment-time"},et={key:0,class:"edited-indicator",title:"Edited"},tt={class:"comment-id"},ot={class:"more-options-wrapper"},nt={class:"comment-content"},st=["innerHTML"],lt={key:2,class:"edit-actions"},it=["disabled"],at={key:0,class:"loading-indicator"},rt={key:1},dt={class:"comment-actions"},ut={key:0,class:"rating-tooltip"},ct={class:"tooltip-row likes"},mt={class:"tooltip-row dislikes"},vt={class:"info-panel-content"},pt={class:"info-section"},ft={class:"info-row"},ht={class:"info-value"},kt={class:"info-row"},gt={class:"info-value"},Ct={class:"info-row"},wt={class:"info-value"},yt={class:"info-row"},bt={class:"info-value"},xt={class:"info-row"},$t={class:"info-value"},It={class:"report-panel-content"},Mt={class:"report-reasons"},Lt=["value"],Rt={class:"reason-title"},At={class:"report-panel-buttons"},Tt=["disabled"],Dt=Ce({__name:"CommentBlock",props:{comment:{},parentCommentId:{},replyToCommentId:{},highlighted:{type:Boolean},depth:{}},emits:["like","react","reply","userClick","mentionClick","delete","edit"],setup(l,{emit:R}){const n=l,b=R,{t:s}=Le(),I=Re(),v=Ae();m(n.comment.userLiked||!1),m(n.comment.likes||0);const u=m(!1),A=m(!1),T=m(!1),L=m(!1),h=m([]),M=m(!1),x=m(""),S=m(!1),$=m(n.comment.userReaction==="like"?"up":n.comment.userReaction==="dislike"?"down":null),D=m(n.comment.likes||0),H=m(n.comment.dislikes||0),B=V(()=>D.value-H.value),j=m(!1),C=m(!1),w=V(()=>C.value?null:je(n.comment.author.avatar)),E=V(()=>{if(!n.comment.updatedAt||!n.comment.createdAt)return!1;const o=typeof n.comment.createdAt=="string"?new Date(n.comment.createdAt):n.comment.createdAt,t=typeof n.comment.updatedAt=="string"?new Date(n.comment.updatedAt):n.comment.updatedAt;return!o||!t||isNaN(o.getTime())||isNaN(t.getTime())?!1:t.getTime()>o.getTime()+1e3});z(()=>n.comment.userReaction,o=>{$.value=o==="like"?"up":o==="dislike"?"down":null},{immediate:!1}),z(()=>n.comment.likes,o=>{D.value=o||0},{immediate:!1}),z(()=>n.comment.dislikes,o=>{H.value=o||0},{immediate:!1}),z(()=>n.comment.author.avatar,()=>{C.value=!1});const N=Te(),q=V(()=>{const o="anon_user_id";let t=localStorage.getItem(o);if(!t){const U=Date.now()%1e8+Math.floor(Math.random()*1e4);t=String(U),localStorage.setItem(o,t)}return Number(t)}),te=V(()=>N.user?.id??q.value),Z=V(()=>{const o=Number(n.comment.author.id),t=Number(te.value);return console.log("Comment author ID:",o,"Current user ID:",t,"Is owner:",o===t),o===t}),ie=V(()=>(n.comment.text||"").replace(/@([a-zA-Z–∞-—è–ê-–Ø—ë–Å0-9_]+)/g,'<span class="mention" style="color: #8c00ff; font-weight: 600; cursor: pointer;" data-mention="$1">@$1</span>')),ae=o=>{if(o.target.classList.contains("mention")){const p=n.replyToCommentId||n.parentCommentId||n.comment.id;b("mentionClick",p),o.stopPropagation()}},re=[{id:"spam",title:"Spam",description:"Unwanted commercial content or repetitive messages"},{id:"harassment",title:"Harassment",description:"Bullying, threats, or personal attacks"},{id:"hate",title:"Hate Speech",description:"Content promoting violence or hatred"},{id:"inappropriate",title:"Inappropriate Content",description:"Sexual, violent, or disturbing content"},{id:"misinformation",title:"Misinformation",description:"False or misleading information"}],de=()=>{b("reply",n.comment.id)},J=()=>{const o=n.comment.author.id;if(o&&o>0){if(N.user&&N.user.id===o){v.add({severity:"info",summary:s("notifications.ownComment.summary","–≠—Ç–æ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"),detail:s("notifications.ownComment.detail","–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è"),life:3e3});return}console.log("üöÄ Navigating to user profile from comment:",o),I.push(`/user/${o}`),b("userClick",o)}else console.warn("‚ùå Cannot navigate to profile: invalid author ID in comment",{authorId:o,commentId:n.comment.id,author:n.comment.author})},oe=()=>{u.value=!u.value},W=m(""),ue=()=>{Z.value&&(W.value=n.comment.text,x.value=n.comment.text,M.value=!0,u.value=!1)},Q=async()=>{if(!x.value.trim()){v.add({severity:"warn",summary:"Error",detail:"Comment cannot be empty",life:3e3});return}if(!N.isAuthenticated||!N.token){v.add({severity:"error",summary:"Authentication Required",detail:"Please log in to edit comments",life:3e3}),I.push("/auth");return}try{S.value=!0,console.log("Saving comment:",n.comment.id,"with text:",x.value.trim()),console.log("Auth token exists:",!!N.token);const o=await Ne(n.comment.id,x.value.trim());console.log("Comment updated successfully:",o),b("edit",n.comment.id,x.value.trim()),M.value=!1,v.add({severity:"success",summary:"Success",detail:"Comment updated successfully",life:3e3})}catch(o){console.error("Failed to update comment:",o),console.error("Error details:",o.response?.data||o.message),console.error("Error status:",o.response?.status);let t="Failed to update comment";o.response?.status===401?(t="Authentication failed. Please log in again.",N.logout()):o.response?.data?.detail?t=o.response.data.detail:o.message&&(t=o.message),v.add({severity:"error",summary:"Error",detail:t,life:3e3})}finally{S.value=!1}},ce=o=>{if(o.key==="Escape"){o.preventDefault(),X();return}if(o.key==="Enter"){if(o.shiftKey)return;o.preventDefault(),Q()}},X=()=>{M.value=!1,x.value=W.value,W.value=""},me=()=>{Z.value&&(u.value=!1,A.value=!0)},Y=()=>{A.value=!1},ve=async()=>{A.value=!1;const o=n.comment.id,{startDelete:t}=He();t(`comment-${o}`,"comment",async()=>{try{await Pe(o,te.value),b("delete",o)}catch(p){console.error("Failed to delete comment:",p),v.add({severity:"error",summary:s("notifications.comment.delete.error.summary"),detail:s("notifications.comment.delete.error.detail"),life:3e3})}},{message:s("notifications.undoDelete.comment.message"),onUndo:async()=>{v.add({severity:"info",summary:s("notifications.comment.delete.cancelled.summary"),detail:s("notifications.comment.delete.cancelled.detail"),life:2e3})}})},pe=()=>{u.value=!1,L.value=!0},F=()=>{L.value=!1},ne=()=>{u.value=!1,T.value=!0,h.value=[]},i=()=>{T.value=!1,h.value=[]},d=()=>{console.log("Report comment:",n.comment.id,"Reasons:",h.value),T.value=!1,h.value=[]},a=async o=>{const t=o==="up"?"like":"dislike",p=$.value;p===o?(o==="up"?D.value=Math.max(0,D.value-1):H.value=Math.max(0,H.value-1),$.value=null):p?(p==="up"?(D.value=Math.max(0,D.value-1),H.value++):(H.value=Math.max(0,H.value-1),D.value++),$.value=o):(o==="up"?D.value++:H.value++,$.value=o),b("react",n.comment.id,t)},k=o=>{if(!o)return"just now";const t=typeof o=="string"?new Date(o):o;if(!t||isNaN(t.getTime()))return"just now";const U=new Date().getTime()-t.getTime(),_=Math.floor(U/(1e3*60)),fe=Math.floor(U/(1e3*60*60)),ee=Math.floor(U/(1e3*60*60*24));return _<1?"just now":_<60?`${_} min ago`:fe<24?`${fe} h ago`:ee===1?"yesterday":ee<7?`${ee} days ago`:t.toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric"})},P=o=>o?(typeof o=="string"?new Date(o):o).toLocaleString("ru-RU",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"N/A",g=o=>{!o.target.closest(".more-options-wrapper")&&u.value&&(u.value=!1)};return xe(()=>{document.addEventListener("click",g)}),Ee(()=>{document.removeEventListener("click",g)}),(o,t)=>(r(),c(se,null,[e("div",{class:O(["comment-block",{highlighted:l.highlighted}]),style:Se({marginLeft:`${(l.depth||0)*40}px`})},[e("div",We,[e("div",{class:"user-avatar",onClick:J},[K(Be,{src:w.value||null,alt:l.comment.author.username},null,8,["src","alt"])]),e("div",Ge,[e("div",Je,[e("div",Qe,[e("h3",{class:"username",onClick:J},f(l.comment.author.username),1),Z.value?(r(),c("span",Xe,f(ke(s)("labels.you")),1)):y("",!0)]),e("div",Ye,[e("span",_e,f(k(l.comment.createdAt)),1),E.value?(r(),c("span",et,[...t[10]||(t[10]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M18.5 2.5C18.8978 2.10217 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10217 21.5 2.5C21.8978 2.89783 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10217 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):y("",!0),e("span",tt,"#"+f(l.comment.id),1)]),e("div",ot,[(r(),c("svg",{width:"24",height:"24",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:O(["more-options-icon",{active:u.value}]),onClick:oe},[...t[11]||(t[11]=[e("path",{d:"M24 26C25.1046 26 26 25.1046 26 24C26 22.8954 25.1046 22 24 22C22.8954 22 22 22.8954 22 24C22 25.1046 22.8954 26 24 26Z",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M24 12C25.1046 12 26 11.1046 26 10C26 8.89543 25.1046 8 24 8C22.8954 8 22 8.89543 22 10C22 11.1046 22.8954 12 24 12Z",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M24 40C25.1046 40 26 39.1046 26 38C26 36.8954 25.1046 36 24 36C22.8954 36 22 36.8954 22 38C22 39.1046 22.8954 40 24 40Z",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2)),K(be,{name:"dropdown-fade"},{default:ye(()=>[u.value?(r(),c("div",{key:0,class:"options-dropdown",onClick:t[0]||(t[0]=G(()=>{},["stop"]))},[Z.value?(r(),c("button",{key:0,class:"dropdown-item",onClick:ue},[...t[12]||(t[12]=[e("svg",{width:"23",height:"23",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M18.5 2.5C18.8978 2.10217 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10217 21.5 2.5C21.8978 2.89783 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10217 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Edit",-1)])])):y("",!0),Z.value?(r(),c("button",{key:1,class:"dropdown-item danger",onClick:me},[...t[13]||(t[13]=[e("svg",{width:"23",height:"23",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M3 6H5H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Delete",-1)])])):y("",!0),e("button",{class:"dropdown-item",onClick:pe},[...t[14]||(t[14]=[e("svg",{width:"23",height:"23",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 16V12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 8H12.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Info",-1)])]),Z.value?y("",!0):(r(),c("button",{key:2,class:"dropdown-item",onClick:ne},[...t[15]||(t[15]=[e("svg",{width:"23",height:"23",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M10.29 3.86L1.82 18C1.64537 18.3024 1.55296 18.6453 1.55199 18.9945C1.55101 19.3437 1.64151 19.6871 1.81445 19.9905C1.98738 20.2939 2.23675 20.5467 2.53773 20.7239C2.83871 20.901 3.18082 20.9962 3.53 21H20.47C20.8192 20.9962 21.1613 20.901 21.4623 20.7239C21.7633 20.5467 22.0126 20.2939 22.1856 19.9905C22.3585 19.6871 22.449 19.3437 22.448 18.9945C22.447 18.6453 22.3546 18.3024 22.18 18L13.71 3.86C13.5317 3.56611 13.2807 3.32312 12.9812 3.15448C12.6817 2.98585 12.3437 2.89725 12 2.89725C11.6563 2.89725 11.3183 2.98585 11.0188 3.15448C10.7193 3.32312 10.4683 3.56611 10.29 3.86V3.86Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 9V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 17H12.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Report",-1)])]))])):y("",!0)]),_:1})])])])]),e("div",nt,[M.value?le((r(),c("textarea",{key:0,"onUpdate:modelValue":t[1]||(t[1]=p=>x.value=p),class:"comment-edit-textarea",rows:"3",onKeydown:ce},null,544)),[[$e,x.value]]):(r(),c("p",{key:1,class:"comment-text",innerHTML:ie.value,onClick:ae},null,8,st)),M.value?(r(),c("div",lt,[e("button",{class:"edit-action-btn save-btn",onClick:Q,disabled:S.value},[S.value?(r(),c("span",at,[...t[16]||(t[16]=[e("span",{class:"spinner"},null,-1),ge(" Saving... ",-1)])])):(r(),c("span",rt,[...t[17]||(t[17]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M5 13L9 17L19 7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Save",-1)])]))],8,it),e("button",{class:"edit-action-btn cancel-btn",onClick:X},[...t[18]||(t[18]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Cancel",-1)])])])):y("",!0)]),e("div",dt,[e("button",{class:"action-btn reply-btn",onClick:de},[...t[19]||(t[19]=[e("svg",{class:"reply-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M9 14L4 9L9 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M20 20V13C20 11.9391 19.5786 10.9217 18.8284 10.1716C18.0783 9.42143 17.0609 9 16 9H4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",{class:"action-text"},"Reply",-1)])]),e("div",{class:"rating-system",onMouseenter:t[4]||(t[4]=p=>j.value=!0),onMouseleave:t[5]||(t[5]=p=>j.value=!1)},[e("button",{class:O(["rating-btn plus-btn",{active:$.value==="up"}]),onClick:t[2]||(t[2]=p=>a("up")),type:"button"},[...t[20]||(t[20]=[e("span",{class:"rating-btn-text"},"+",-1)])],2),e("p",{class:O(["rating-text",{positive:B.value>0,negative:B.value<0}])},f(B.value),3),e("button",{class:O(["rating-btn minus-btn",{active:$.value==="down"}]),onClick:t[3]||(t[3]=p=>a("down")),type:"button"},[...t[21]||(t[21]=[e("span",{class:"rating-btn-text"},"‚àí",-1)])],2),K(be,{name:"tooltip-fade"},{default:ye(()=>[j.value?(r(),c("div",ut,[e("div",ct,[t[22]||(t[22]=e("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M7 11L12 6L17 11M12 18V7",stroke:"#22c55e","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("span",null,f(D.value),1)]),e("div",mt,[t[23]||(t[23]=e("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M17 13L12 18L7 13M12 6V17",stroke:"#ef4444","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("span",null,f(H.value),1)])])):y("",!0)]),_:1})],32)]),A.value?(r(),c("div",{key:0,class:"delete-panel-overlay",onClick:Y},[e("div",{class:"delete-panel",onClick:t[6]||(t[6]=G(()=>{},["stop"]))},[e("div",{class:"delete-panel-content"},[t[24]||(t[24]=e("p",{class:"delete-panel-text"},"Are you sure you want to delete this comment?",-1)),e("div",{class:"delete-panel-buttons"},[e("button",{class:"delete-panel-button cancel",onClick:Y},"Cancel"),e("button",{class:"delete-panel-button confirm",onClick:ve},"Delete")])])])])):y("",!0),L.value?(r(),c("div",{key:1,class:"info-panel-overlay",onClick:F},[e("div",{class:"info-panel",onClick:t[7]||(t[7]=G(()=>{},["stop"]))},[e("div",vt,[t[30]||(t[30]=e("h3",{class:"info-panel-title"},"Comment Information",-1)),e("div",pt,[e("div",ft,[t[25]||(t[25]=e("span",{class:"info-label"},"Comment ID:",-1)),e("span",ht,f(l.comment.id),1)]),e("div",kt,[t[26]||(t[26]=e("span",{class:"info-label"},"Author:",-1)),e("span",gt,f(l.comment.author.username),1)]),e("div",Ct,[t[27]||(t[27]=e("span",{class:"info-label"},"Published:",-1)),e("span",wt,f(P(l.comment.createdAt)),1)]),e("div",yt,[t[28]||(t[28]=e("span",{class:"info-label"},"Rating:",-1)),e("span",bt,f(B.value>0?"+":"")+f(B.value)+" ("+f(D.value)+" ‚Üë / "+f(H.value)+" ‚Üì)",1)]),e("div",xt,[t[29]||(t[29]=e("span",{class:"info-label"},"Text Length:",-1)),e("span",$t,f(l.comment.text.length)+" characters",1)])]),e("div",{class:"info-panel-buttons"},[e("button",{class:"info-panel-button close",onClick:F},"Close")])])])])):y("",!0),T.value?(r(),c("div",{key:2,class:"report-panel-overlay",onClick:i},[e("div",{class:"report-panel",onClick:t[9]||(t[9]=G(()=>{},["stop"]))},[e("div",It,[t[32]||(t[32]=e("h3",{class:"report-panel-title"},"Report Comment",-1)),t[33]||(t[33]=e("p",{class:"report-panel-subtitle"},"Select the reason for reporting:",-1)),e("div",Mt,[(r(),c(se,null,Ie(re,p=>e("label",{key:p.id,class:O(["reason-item",{selected:h.value.includes(p.id)}])},[le(e("input",{type:"checkbox",value:p.id,"onUpdate:modelValue":t[8]||(t[8]=U=>h.value=U),class:"reason-checkbox"},null,8,Lt),[[Ve,h.value]]),t[31]||(t[31]=e("span",{class:"reason-checkmark"},null,-1)),e("span",Rt,f(p.title),1)],2)),64))]),e("div",At,[e("button",{class:"report-panel-button cancel",onClick:i},"Cancel"),e("button",{class:"report-panel-button confirm",onClick:d,disabled:h.value.length===0}," Submit Report ",8,Tt)])])])])):y("",!0)],6),K(ke(De))],64))}}),jt=we(Dt,[["__scopeId","data-v-a3fdad4e"]]),Et={class:"comment-header"},St={class:"user-info"},Bt={class:"user-name-row"},Vt={class:"username-with-badge"},Ht={key:0,class:"self-badge"},Ut={class:"comment-meta"},Nt={class:"comment-time"},Pt={key:0,class:"edited-indicator",title:"Edited"},Ot={class:"comment-id"},Ft={class:"more-options-wrapper"},Zt={class:"comment-content"},Kt=["innerHTML"],qt={key:2,class:"edit-actions"},zt=["disabled"],Wt={key:0,class:"loading-indicator"},Gt={key:1},Jt={class:"comment-actions"},Qt={key:0,class:"rating-tooltip"},Xt={class:"tooltip-row likes"},Yt={class:"tooltip-row dislikes"},_t={class:"info-panel-content"},eo={class:"info-section"},to={class:"info-row"},oo={class:"info-value"},no={class:"info-row"},so={class:"info-value"},lo={class:"info-row"},io={class:"info-value"},ao={class:"info-row"},ro={class:"info-value"},uo={class:"info-row"},co={class:"info-value"},mo={class:"report-panel-content"},vo={class:"report-reasons"},po=["value"],fo={class:"reason-title"},ho={class:"report-panel-buttons"},ko=["disabled"],go=Ce({__name:"AuthorCommentBlock",props:{comment:{},parentCommentId:{},replyToCommentId:{},highlighted:{type:Boolean},depth:{}},emits:["like","react","reply","userClick","mentionClick","delete","edit"],setup(l,{emit:R}){const n=l,b=R,{t:s}=Le(),I=Re(),v=Ae();m(n.comment.userLiked||!1),m(n.comment.likes||0);const u=m(!1),A=m(!1),T=m(!1),L=m(!1),h=m([]),M=m(!1),x=m(""),S=m(!1),$=Te(),D=V(()=>{const o="anon_user_id";let t=localStorage.getItem(o);if(!t){const U=Date.now()%1e8+Math.floor(Math.random()*1e4);t=String(U),localStorage.setItem(o,t)}return Number(t)}),H=V(()=>$.user?.id??D.value),B=V(()=>{const o=Number(n.comment.author.id),t=Number(H.value);return console.log("AuthorCommentBlock - Comment author ID:",o,"Current user ID:",t,"Is owner:",o===t),o===t}),j=m(n.comment.userReaction==="like"?"up":n.comment.userReaction==="dislike"?"down":null),C=m(n.comment.likes||0),w=m(n.comment.dislikes||0),E=V(()=>C.value-w.value),N=m(!1),q=m(!1),te=V(()=>q.value?null:je(n.comment.author.avatar));z(()=>n.comment.author.avatar,()=>{q.value=!1});const Z=V(()=>{if(!n.comment.updatedAt||!n.comment.createdAt)return!1;const o=typeof n.comment.createdAt=="string"?new Date(n.comment.createdAt):n.comment.createdAt,t=typeof n.comment.updatedAt=="string"?new Date(n.comment.updatedAt):n.comment.updatedAt;return!o||!t||isNaN(o.getTime())||isNaN(t.getTime())?!1:t.getTime()>o.getTime()+1e3});z(()=>n.comment.userReaction,o=>{j.value=o==="like"?"up":o==="dislike"?"down":null},{immediate:!1}),z(()=>n.comment.likes,o=>{C.value=o||0},{immediate:!1}),z(()=>n.comment.dislikes,o=>{w.value=o||0},{immediate:!1});const ie=V(()=>(n.comment.text||"").replace(/@([a-zA-Z–∞-—è–ê-–Ø—ë–Å0-9_]+)/g,'<span class="mention" style="color: #8c00ff; font-weight: 600; cursor: pointer;" data-mention="$1">@$1</span>')),ae=o=>{if(o.target.classList.contains("mention")){const p=n.replyToCommentId||n.parentCommentId||n.comment.id;b("mentionClick",p),o.stopPropagation()}},re=[{id:"spam",title:"Spam",description:"Unwanted commercial content or repetitive messages"},{id:"harassment",title:"Harassment",description:"Bullying, threats, or personal attacks"},{id:"hate",title:"Hate Speech",description:"Content promoting violence or hatred"},{id:"inappropriate",title:"Inappropriate Content",description:"Sexual, violent, or disturbing content"},{id:"misinformation",title:"Misinformation",description:"False or misleading information"}],de=()=>{b("reply",n.comment.id)},J=()=>{const o=n.comment.author.id;if(o&&o>0){if($.user&&$.user.id===o){v.add({severity:"info",summary:s("notifications.ownComment.summary","–≠—Ç–æ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"),detail:s("notifications.ownComment.detail","–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è"),life:3e3});return}console.log("üöÄ Navigating to user profile from author comment:",o),I.push(`/user/${o}`),b("userClick",o)}else console.warn("‚ùå Cannot navigate to profile: invalid author ID in author comment",{authorId:o,commentId:n.comment.id,author:n.comment.author})},oe=()=>{u.value=!u.value},W=m(""),ue=()=>{B.value&&(W.value=n.comment.text,x.value=n.comment.text,M.value=!0,u.value=!1)},Q=async()=>{if(!x.value.trim()){v.add({severity:"warn",summary:"Error",detail:"Comment cannot be empty",life:3e3});return}if(!$.isAuthenticated||!$.token){v.add({severity:"error",summary:"Authentication Required",detail:"Please log in to edit comments",life:3e3}),I.push("/auth");return}try{S.value=!0,console.log("Saving comment:",n.comment.id,"with text:",x.value.trim()),console.log("Auth token exists:",!!$.token);const o=await Ne(n.comment.id,x.value.trim());console.log("Comment updated successfully:",o),b("edit",n.comment.id,x.value.trim()),M.value=!1,v.add({severity:"success",summary:"Success",detail:"Comment updated successfully",life:3e3})}catch(o){console.error("Failed to update comment:",o),console.error("Error details:",o.response?.data||o.message),console.error("Error status:",o.response?.status);let t="Failed to update comment";o.response?.status===401?(t="Authentication failed. Please log in again.",$.logout()):o.response?.data?.detail?t=o.response.data.detail:o.message&&(t=o.message),v.add({severity:"error",summary:"Error",detail:t,life:3e3})}finally{S.value=!1}},ce=o=>{if(o.key==="Escape"){o.preventDefault(),X();return}if(o.key==="Enter"){if(o.shiftKey)return;o.preventDefault(),Q()}},X=()=>{M.value=!1,x.value=W.value,W.value=""},me=()=>{B.value&&(u.value=!1,A.value=!0)},Y=()=>{A.value=!1},ve=async()=>{A.value=!1;const o=n.comment.id,{startDelete:t}=He();t(`comment-${o}`,"comment",async()=>{try{await Pe(o,H.value),b("delete",o)}catch(p){console.error("Failed to delete comment:",p),v.add({severity:"error",summary:s("notifications.comment.delete.error.summary"),detail:s("notifications.comment.delete.error.detail"),life:3e3})}},{message:s("notifications.undoDelete.comment.message"),onUndo:async()=>{v.add({severity:"info",summary:s("notifications.comment.delete.cancelled.summary"),detail:s("notifications.comment.delete.cancelled.detail"),life:2e3})}})},pe=()=>{u.value=!1,L.value=!0},F=()=>{L.value=!1},ne=()=>{u.value=!1,T.value=!0,h.value=[]},i=()=>{T.value=!1,h.value=[]},d=()=>{console.log("Report comment:",n.comment.id,"Reasons:",h.value),T.value=!1,h.value=[]},a=async o=>{const t=o==="up"?"like":"dislike",p=j.value;p===o?(o==="up"?C.value=Math.max(0,C.value-1):w.value=Math.max(0,w.value-1),j.value=null):p?(p==="up"?(C.value=Math.max(0,C.value-1),w.value++):(w.value=Math.max(0,w.value-1),C.value++),j.value=o):(o==="up"?C.value++:w.value++,j.value=o),b("react",n.comment.id,t)},k=o=>{if(!o)return"just now";const t=typeof o=="string"?new Date(o):o;if(!t||isNaN(t.getTime()))return"just now";const U=new Date().getTime()-t.getTime(),_=Math.floor(U/(1e3*60)),fe=Math.floor(U/(1e3*60*60)),ee=Math.floor(U/(1e3*60*60*24));return _<1?"just now":_<60?`${_} min ago`:fe<24?`${fe} h ago`:ee===1?"yesterday":ee<7?`${ee} days ago`:t.toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric"})},P=o=>o?(typeof o=="string"?new Date(o):o).toLocaleString("ru-RU",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"N/A",g=o=>{!o.target.closest(".more-options-wrapper")&&u.value&&(u.value=!1)};return xe(()=>{document.addEventListener("click",g)}),Ee(()=>{document.removeEventListener("click",g)}),(o,t)=>(r(),c(se,null,[e("div",{class:O(["author-comment-block",{highlighted:l.highlighted}]),style:Se({marginLeft:`${(l.depth||0)*40}px`})},[e("div",Et,[e("div",{class:"user-avatar author-avatar",onClick:J},[K(Be,{src:te.value||null,alt:l.comment.author.username},null,8,["src","alt"])]),e("div",St,[e("div",Bt,[e("div",Vt,[e("h3",{class:"username author-username",onClick:J},f(l.comment.author.username),1),B.value?(r(),c("span",Ht,f(ke(s)("labels.you")),1)):y("",!0),t[10]||(t[10]=e("span",{class:"author-badge"},[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",fill:"currentColor"})]),ge(" Author ")],-1))]),e("div",Ut,[e("span",Nt,f(k(l.comment.createdAt)),1),Z.value?(r(),c("span",Pt,[...t[11]||(t[11]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M18.5 2.5C18.8978 2.10217 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10217 21.5 2.5C21.8978 2.89783 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10217 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):y("",!0),e("span",Ot,"#"+f(l.comment.id),1)]),e("div",Ft,[(r(),c("svg",{width:"24",height:"24",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:O(["more-options-icon",{active:u.value}]),onClick:oe},[...t[12]||(t[12]=[e("path",{d:"M24 26C25.1046 26 26 25.1046 26 24C26 22.8954 25.1046 22 24 22C22.8954 22 22 22.8954 22 24C22 25.1046 22.8954 26 24 26Z",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M24 12C25.1046 12 26 11.1046 26 10C26 8.89543 25.1046 8 24 8C22.8954 8 22 8.89543 22 10C22 11.1046 22.8954 12 24 12Z",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M24 40C25.1046 40 26 39.1046 26 38C26 36.8954 25.1046 36 24 36C22.8954 36 22 36.8954 22 38C22 39.1046 22.8954 40 24 40Z",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2)),K(be,{name:"dropdown-fade"},{default:ye(()=>[u.value?(r(),c("div",{key:0,class:"options-dropdown",onClick:t[0]||(t[0]=G(()=>{},["stop"]))},[B.value?(r(),c("button",{key:0,class:"dropdown-item",onClick:ue},[...t[13]||(t[13]=[e("svg",{width:"23",height:"23",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M18.5 2.5C18.8978 2.10217 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10217 21.5 2.5C21.8978 2.89783 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10217 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Edit",-1)])])):y("",!0),B.value?(r(),c("button",{key:1,class:"dropdown-item danger",onClick:me},[...t[14]||(t[14]=[e("svg",{width:"23",height:"23",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M3 6H5H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Delete",-1)])])):y("",!0),e("button",{class:"dropdown-item",onClick:pe},[...t[15]||(t[15]=[e("svg",{width:"23",height:"23",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 16V12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 8H12.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Info",-1)])]),B.value?y("",!0):(r(),c("button",{key:2,class:"dropdown-item",onClick:ne},[...t[16]||(t[16]=[e("svg",{width:"23",height:"23",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M10.29 3.86L1.82 18C1.64537 18.3024 1.55296 18.6453 1.55199 18.9945C1.55101 19.3437 1.64151 19.6871 1.81445 19.9905C1.98738 20.2939 2.23675 20.5467 2.53773 20.7239C2.83871 20.901 3.18082 20.9962 3.53 21H20.47C20.8192 20.9962 21.1613 20.901 21.4623 20.7239C21.7633 20.5467 22.0126 20.2939 22.1856 19.9905C22.3585 19.6871 22.449 19.3437 22.448 18.9945C22.447 18.6453 22.3546 18.3024 22.18 18L13.71 3.86C13.5317 3.56611 13.2807 3.32312 12.9812 3.15448C12.6817 2.98585 12.3437 2.89725 12 2.89725C11.6563 2.89725 11.3183 2.98585 11.0188 3.15448C10.7193 3.32312 10.4683 3.56611 10.29 3.86V3.86Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 9V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 17H12.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Report",-1)])]))])):y("",!0)]),_:1})])])])]),e("div",Zt,[M.value?le((r(),c("textarea",{key:0,"onUpdate:modelValue":t[1]||(t[1]=p=>x.value=p),class:"comment-edit-textarea",rows:"3",onKeydown:ce},null,544)),[[$e,x.value]]):(r(),c("p",{key:1,class:"comment-text",innerHTML:ie.value,onClick:ae},null,8,Kt)),M.value?(r(),c("div",qt,[e("button",{class:"edit-action-btn save-btn",onClick:Q,disabled:S.value},[S.value?(r(),c("span",Wt,[...t[17]||(t[17]=[e("span",{class:"spinner"},null,-1),ge(" Saving... ",-1)])])):(r(),c("span",Gt,[...t[18]||(t[18]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M5 13L9 17L19 7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Save",-1)])]))],8,zt),e("button",{class:"edit-action-btn cancel-btn",onClick:X},[...t[19]||(t[19]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Cancel",-1)])])])):y("",!0)]),e("div",Jt,[e("button",{class:"action-btn reply-btn",onClick:de},[...t[20]||(t[20]=[e("svg",{class:"reply-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M9 14L4 9L9 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M20 20V13C20 11.9391 19.5786 10.9217 18.8284 10.1716C18.0783 9.42143 17.0609 9 16 9H4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",{class:"action-text"},"Reply",-1)])]),e("div",{class:"rating-system",onMouseenter:t[4]||(t[4]=p=>N.value=!0),onMouseleave:t[5]||(t[5]=p=>N.value=!1)},[e("button",{class:O(["rating-btn plus-btn",{active:j.value==="up"}]),onClick:t[2]||(t[2]=p=>a("up")),type:"button"},[...t[21]||(t[21]=[e("span",{class:"rating-btn-text"},"+",-1)])],2),e("p",{class:O(["rating-text",{positive:E.value>0,negative:E.value<0}])},f(E.value),3),e("button",{class:O(["rating-btn minus-btn",{active:j.value==="down"}]),onClick:t[3]||(t[3]=p=>a("down")),type:"button"},[...t[22]||(t[22]=[e("span",{class:"rating-btn-text"},"‚àí",-1)])],2),K(be,{name:"tooltip-fade"},{default:ye(()=>[N.value?(r(),c("div",Qt,[e("div",Xt,[t[23]||(t[23]=e("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M7 11L12 6L17 11M12 18V7",stroke:"#22c55e","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("span",null,f(C.value),1)]),e("div",Yt,[t[24]||(t[24]=e("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M17 13L12 18L7 13M12 6V17",stroke:"#ef4444","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("span",null,f(w.value),1)])])):y("",!0)]),_:1})],32)]),A.value?(r(),c("div",{key:0,class:"delete-panel-overlay",onClick:Y},[e("div",{class:"delete-panel",onClick:t[6]||(t[6]=G(()=>{},["stop"]))},[e("div",{class:"delete-panel-content"},[t[25]||(t[25]=e("p",{class:"delete-panel-text"},"Are you sure you want to delete this comment?",-1)),e("div",{class:"delete-panel-buttons"},[e("button",{class:"delete-panel-button cancel",onClick:Y},"Cancel"),e("button",{class:"delete-panel-button confirm",onClick:ve},"Delete")])])])])):y("",!0),L.value?(r(),c("div",{key:1,class:"info-panel-overlay",onClick:F},[e("div",{class:"info-panel",onClick:t[7]||(t[7]=G(()=>{},["stop"]))},[e("div",_t,[t[31]||(t[31]=e("h3",{class:"info-panel-title"},"Comment Information",-1)),e("div",eo,[e("div",to,[t[26]||(t[26]=e("span",{class:"info-label"},"Comment ID:",-1)),e("span",oo,f(l.comment.id),1)]),e("div",no,[t[27]||(t[27]=e("span",{class:"info-label"},"Author:",-1)),e("span",so,f(l.comment.author.username),1)]),e("div",lo,[t[28]||(t[28]=e("span",{class:"info-label"},"Published:",-1)),e("span",io,f(P(l.comment.createdAt)),1)]),e("div",ao,[t[29]||(t[29]=e("span",{class:"info-label"},"Rating:",-1)),e("span",ro,f(E.value>0?"+":"")+f(E.value)+" ("+f(C.value)+" ‚Üë / "+f(w.value)+" ‚Üì)",1)]),e("div",uo,[t[30]||(t[30]=e("span",{class:"info-label"},"Text Length:",-1)),e("span",co,f(l.comment.text.length)+" characters",1)])]),e("div",{class:"info-panel-buttons"},[e("button",{class:"info-panel-button close",onClick:F},"Close")])])])])):y("",!0),T.value?(r(),c("div",{key:2,class:"report-panel-overlay",onClick:i},[e("div",{class:"report-panel",onClick:t[9]||(t[9]=G(()=>{},["stop"]))},[e("div",mo,[t[33]||(t[33]=e("h3",{class:"report-panel-title"},"Report Comment",-1)),t[34]||(t[34]=e("p",{class:"report-panel-subtitle"},"Select the reason for reporting:",-1)),e("div",vo,[(r(),c(se,null,Ie(re,p=>e("label",{key:p.id,class:O(["reason-item",{selected:h.value.includes(p.id)}])},[le(e("input",{type:"checkbox",value:p.id,"onUpdate:modelValue":t[8]||(t[8]=U=>h.value=U),class:"reason-checkbox"},null,8,po),[[Ve,h.value]]),t[32]||(t[32]=e("span",{class:"reason-checkmark"},null,-1)),e("span",fo,f(p.title),1)],2)),64))]),e("div",ho,[e("button",{class:"report-panel-button cancel",onClick:i},"Cancel"),e("button",{class:"report-panel-button confirm",onClick:d,disabled:h.value.length===0}," Submit Report ",8,ko)])])])])):y("",!0)],6),K(ke(De))],64))}}),Co=we(go,[["__scopeId","data-v-2dd230e7"]]),wo={key:0,class:"reply-indicator"},yo={class:"reply-to-text"},bo={class:"reply-username"},xo={class:"comment-input-container"},$o=["placeholder","rows","disabled"],Io=["disabled"],Mo={key:0,class:"loading-indicator"},Lo={key:1},Ro=Ce({__name:"CommentInput",props:{isReply:{type:Boolean,default:!1},replyToUser:{},replyToId:{},placeholder:{default:"Write a comment..."},rows:{default:3},submitButtonText:{default:"Submit"},isLoading:{type:Boolean}},emits:["submit","cancel"],setup(l,{emit:R}){const n=l,b=R,s=m(""),I=m(null);z(()=>n.replyToUser,L=>{L&&!s.value.startsWith(`@${L}`)&&(s.value=`@${L}, `,Me(()=>{if(I.value){I.value.focus();const h=s.value.length;I.value.setSelectionRange(h,h)}}))},{immediate:!0});const v=L=>{L.shiftKey||(L.preventDefault(),u())},u=()=>{s.value.trim()&&(b("submit",{text:s.value.trim(),replyToId:n.replyToId,replyToUser:n.replyToUser}),s.value="")},A=()=>{s.value="",b("cancel")},T=()=>{I.value&&(I.value.style.height="auto",I.value.style.height=I.value.scrollHeight+"px")};return xe(()=>{n.isReply&&I.value&&I.value.focus()}),(L,h)=>(r(),c("div",{class:O(["comment-input-wrapper",{"reply-input":l.isReply}])},[l.replyToUser?(r(),c("div",wo,[h[3]||(h[3]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M9 14L4 9L9 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M20 20V13C20 11.9391 19.5786 10.9217 18.8284 10.1716C18.0783 9.42143 17.0609 9 16 9H4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("span",yo,[h[1]||(h[1]=ge("Replying to ",-1)),e("span",bo,"@"+f(l.replyToUser),1)]),e("button",{class:"cancel-reply-btn",onClick:A},[...h[2]||(h[2]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])])):y("",!0),e("div",xo,[h[5]||(h[5]=Oe('<div class="user-avatar-small" data-v-6d60db33><svg class="question-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-6d60db33><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-6d60db33></path><path d="M9.09 9C9.3251 8.33167 9.78915 7.76811 10.4 7.40913C11.0108 7.05016 11.7289 6.91894 12.4272 7.03871C13.1255 7.15849 13.7588 7.52152 14.2151 8.06353C14.6713 8.60553 14.9211 9.29152 14.92 10C14.92 12 11.92 13 11.92 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-6d60db33></path><path d="M12 17H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-6d60db33></path></svg></div>',1)),le(e("textarea",{ref_key:"textareaRef",ref:I,"onUpdate:modelValue":h[0]||(h[0]=M=>s.value=M),class:"comment-input",placeholder:l.placeholder,rows:l.rows,onKeydown:Ue(v,["enter"]),onInput:T,disabled:l.isLoading},null,40,$o),[[$e,s.value]]),e("button",{class:"submit-comment-btn",onClick:u,disabled:!s.value.trim()||l.isLoading},[l.isLoading?(r(),c("span",Mo,[h[4]||(h[4]=e("span",{class:"spinner"},null,-1)),ge(" "+f(l.isReply?"Posting...":l.submitButtonText),1)])):(r(),c("span",Lo,f(l.submitButtonText),1))],8,Io)])],2))}}),Ao=we(Ro,[["__scopeId","data-v-6d60db33"]]),To={class:"comment-thread"},Do={name:"CommentThread"},jo=Ce({...Do,props:{comment:{},highlightedCommentId:{},replyingTo:{},editingCommentId:{},isPostingReply:{type:Boolean}},emits:["like","react","reply","userClick","mentionClick","delete","edit","submitReply","cancelReply"],setup(l,{emit:R}){const n=R;return(b,s)=>{const I=Fe("CommentThread",!0);return r(),c("div",To,[l.comment.author.isAuthor?(r(),he(Co,{key:0,id:`comment-${l.comment.id}`,comment:l.comment,"parent-comment-id":l.comment.parentId,"reply-to-comment-id":l.comment.replyToCommentId,depth:l.comment.depth,highlighted:l.highlightedCommentId===l.comment.id,onLike:s[0]||(s[0]=v=>n("like",l.comment.id)),onReact:s[1]||(s[1]=(v,u)=>n("react",v,u)),onReply:s[2]||(s[2]=v=>n("reply",l.comment.id)),onUserClick:s[3]||(s[3]=v=>n("userClick",v)),onMentionClick:s[4]||(s[4]=v=>n("mentionClick",v)),onDelete:s[5]||(s[5]=v=>n("delete",l.comment.id)),onEdit:s[6]||(s[6]=(v,u)=>n("edit",v,u))},null,8,["id","comment","parent-comment-id","reply-to-comment-id","depth","highlighted"])):(r(),he(jt,{key:1,id:`comment-${l.comment.id}`,comment:l.comment,"parent-comment-id":l.comment.parentId,"reply-to-comment-id":l.comment.replyToCommentId,depth:l.comment.depth,highlighted:l.highlightedCommentId===l.comment.id,onLike:s[7]||(s[7]=v=>n("like",l.comment.id)),onReact:s[8]||(s[8]=(v,u)=>n("react",v,u)),onReply:s[9]||(s[9]=v=>n("reply",l.comment.id)),onUserClick:s[10]||(s[10]=v=>n("userClick",v)),onMentionClick:s[11]||(s[11]=v=>n("mentionClick",v)),onDelete:s[12]||(s[12]=v=>n("delete",l.comment.id)),onEdit:s[13]||(s[13]=(v,u)=>n("edit",v,u))},null,8,["id","comment","parent-comment-id","reply-to-comment-id","depth","highlighted"])),l.replyingTo&&l.replyingTo.id===l.comment.id?(r(),he(Ao,{key:2,"is-reply":!0,"reply-to-user":l.comment.parentId!=null||l.comment.children&&l.comment.children.length>0?l.replyingTo.username:null,"reply-to-id":l.replyingTo.id,"is-loading":l.isPostingReply&&l.replyingTo.id===l.comment.id,placeholder:b.$t("comments.replyPlaceholder"),"submit-button-text":b.$t("comments.reply"),onSubmit:s[14]||(s[14]=v=>n("submitReply",v)),onCancel:s[15]||(s[15]=v=>n("cancelReply"))},null,8,["reply-to-user","reply-to-id","is-loading","placeholder","submit-button-text"])):y("",!0),l.comment.children&&l.comment.children.length>0?(r(!0),c(se,{key:3},Ie(l.comment.children,v=>(r(),he(I,{key:v.id,comment:v,"highlighted-comment-id":l.highlightedCommentId,"replying-to":l.replyingTo,"editing-comment-id":l.editingCommentId,"is-posting-reply":l.isPostingReply,onLike:s[16]||(s[16]=u=>n("like",u)),onReact:s[17]||(s[17]=(u,A)=>n("react",u,A)),onReply:s[18]||(s[18]=u=>n("reply",u)),onUserClick:s[19]||(s[19]=u=>n("userClick",u)),onMentionClick:s[20]||(s[20]=u=>n("mentionClick",u)),onDelete:s[21]||(s[21]=u=>n("delete",u)),onEdit:s[22]||(s[22]=(u,A)=>n("edit",u,A)),onSubmitReply:s[23]||(s[23]=u=>n("submitReply",u)),onCancelReply:s[24]||(s[24]=u=>n("cancelReply"))},null,8,["comment","highlighted-comment-id","replying-to","editing-comment-id","is-posting-reply"]))),128)):y("",!0)])}}}),Eo=we(jo,[["__scopeId","data-v-3faf61ec"]]),So={class:"full-article-page"},Bo={key:0,class:"loading-container"},Vo={class:"loading-text"},Ho={key:1,class:"error-container"},Uo={class:"error-text"},No={class:"error-message"},Po={key:2,class:"article-container"},Oo={class:"comments-section",id:"comments"},Fo={class:"comments-title"},Zo={class:"comment-input-container"},Ko=["onKeydown"],qo=["disabled"],zo={class:"comments-list"},Wo={key:0,class:"no-comments"},Go={key:3,class:"not-found-container"},Jo={class:"not-found-text"},Qo=Ce({__name:"FullArticle",setup(l){const{t:R}=Le(),n=Ze(),b=Re(),s=Ae(),{getArticle:I,fetchComments:v,addComment:u,reactCommentFn:A}=ze(),T=m(null),L=m(!0),h=m(null),M=m(""),x=m(null),S=m(null),$=m(null),D=m(null),H=Te(),B=m(!1),j=m(null),C=m([]),w=m([]),E=m([]),N=V(()=>C.value.length+w.value.length),q=m(parseInt(n.params.id)),te=async()=>{try{if(L.value=!0,h.value=null,isNaN(q.value))throw new Error("Invalid article ID");const i=await I(q.value);T.value=i;const a=(await v(q.value)).map(k=>({id:k.id,author:{id:k.author_id??0,username:k.author_name||"Guest",avatar:k.author_avatar||void 0,isAuthor:(k.author_name||"")===(i.author?.username||i.author||"")},text:k.text,createdAt:k.created_at,updatedAt:k.updated_at??null,likes:k.likes??0,dislikes:k.dislikes??0,userLiked:k.user_reaction==="like",userReaction:k.user_reaction??null,parentId:k.parent_id??null,replyToCommentId:k.parent_id??null}));C.value=a.filter(k=>!k.parentId),w.value=a.filter(k=>!!k.parentId),E.value=F(a),console.log("Comment tree built:",E.value)}catch(i){console.error("Error loading article:",i),i.response?.status===404?h.value="–°—Ç–∞—Ç—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞":i.response?.status===403?h.value="–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ":h.value=i instanceof Error?i.message:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç—å–∏"}finally{L.value=!1}},Z=()=>{b.go(-1)},ie=i=>{console.log("–°—Ç–∞—Ç—å—è —É–¥–∞–ª–µ–Ω–∞:",i),s.add({severity:"error",summary:R("notifications.deleteArticle.success.summary","–°—Ç–∞—Ç—å—è —É–¥–∞–ª–µ–Ω–∞"),detail:R("notifications.deleteArticle.success.detail","–°—Ç–∞—Ç—å—è –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞"),life:3e3}),b.push("/")},ae=i=>{j.value=i,B.value=!0},re=()=>{B.value=!1,D.value&&typeof D.value.resetShareState=="function"&&D.value.resetShareState(),j.value=null},de=V(()=>j.value&&typeof window<"u"?`${window.location.origin}/article/${j.value.id}`:""),J=async()=>{try{if(!M.value.trim())return;if(!H.isAuthenticated){s.add({severity:"warn",summary:R("common.warning","–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥"),detail:R("comments.auth_required","–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"),life:3e3}),b.push("/auth");return}const i=await oe(M.value);C.value.unshift(i),M.value="";const d=[...C.value,...w.value];E.value=F(d)}catch(i){const d=i?.response?.status;d===401||d===403?(s.add({severity:"error",summary:R("common.error","–û—à–∏–±–∫–∞"),detail:R("comments.auth_required","–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"),life:3e3}),b.push("/auth")):s.add({severity:"error",summary:R("common.error","–û—à–∏–±–∫–∞"),detail:i?.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",life:3e3})}};async function oe(i,d){console.log("Adding comment with parent_id:",d);const a=await u(q.value,i,d??null);return console.log("Comment created from API:",a),{id:a.id,author:{id:a.author_id??0,username:a.author_name||"Guest",avatar:"",isAuthor:(a.author_name||"")===(T.value?.author?.username||T.value?.author||"")},text:a.text,createdAt:a.created_at,updatedAt:a.updated_at??null,likes:a.likes??0,dislikes:a.dislikes??0,userLiked:a.user_reaction==="like",userReaction:a.user_reaction??null,parentId:a.parent_id??null,replyToCommentId:a.parent_id??null}}const W=i=>{console.log("Like comment:",i)},ue=async(i,d)=>{try{const a=await A(i,d),k=g=>{g.id===i&&(g.likes=a.likes??0,g.dislikes=a.dislikes??0,g.userReaction=a.user_reaction??null,g.userLiked=a.user_reaction==="like"),g.children&&g.children.forEach(k)};C.value.forEach(k),w.value.forEach(k);const P=[...C.value,...w.value];E.value=F(P)}catch(a){console.error("Error reacting to comment:",a)}},Q=i=>{const d=C.value.find(a=>a.id===i)||w.value.find(a=>a.id===i);d&&(x.value={id:i,parentId:i,username:d.author.username})},ce=async i=>{if(!x.value)return;const d=await oe(i.text,x.value.id);w.value.push(d),x.value=null;const a=[...C.value,...w.value];E.value=F(a)},X=()=>{x.value=null},me=i=>{console.log("User clicked:",i)},Y=(i,d)=>{const a=P=>{P.id===i&&(P.text=d,P.updatedAt=new Date().toISOString()),P.children&&P.children.forEach(a)};C.value.forEach(a),w.value.forEach(a);const k=[...C.value,...w.value];E.value=F(k)},ve=i=>{C.value=C.value.filter(a=>a.id!==i),w.value=w.value.filter(a=>a.id!==i);const d=[...C.value,...w.value];E.value=F(d),N.value=d.length,s.add({severity:"error",summary:R("notifications.comment.deleted.summary","–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É–¥–∞–ª–µ–Ω"),detail:R("notifications.comment.deleted.detail","–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –±—ã–ª —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω"),life:3e3})},pe=i=>{S.value=i,Me(()=>{const d=document.getElementById(`comment-${i}`);d?(d.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{setTimeout(()=>{S.value=null},3e3)},800)):setTimeout(()=>{S.value=null},3e3)})};function F(i,d=0){console.log("Building tree from comments:",i);const a=new Map,k=[],P=[...i].sort((g,o)=>!g.parentId&&o.parentId?-1:g.parentId&&!o.parentId?1:0);return P.forEach(g=>{a.set(g.id,{...g,depth:d,children:[]})}),P.forEach(g=>{const o=a.get(g.id);if(g.parentId){const t=a.get(g.parentId);console.log(`Comment ${g.id} has parent ${g.parentId}`,t?"found":"NOT FOUND"),t?(o.depth=1,t.children=t.children||[],t.children.push(o),console.log(`Added comment ${g.id} as child of ${g.parentId}, depth: ${o.depth}`)):(k.push(o),console.log(`Parent not found for comment ${g.id}, adding as root`))}else k.push(o),console.log(`Comment ${g.id} is a root comment`)}),console.log("Root comments:",k),k}xe(async()=>{console.log("FullArticle mounted, articleId:",q.value),console.log("Current route:",n.path,n.params,n.hash),window.scrollTo({top:0,behavior:"instant"}),await te();const i=window.location.hash;console.log("URL hash:",i),i&&(i==="#comments"||i.startsWith("#comment-"))&&(await Me(),setTimeout(()=>{if(i==="#comments"){const d=document.getElementById("comments");d&&(d.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{$.value&&$.value.focus()},300))}else{const d=parseInt(i.replace("#comment-",""));d&&(console.log("Attempting to scroll to comment:",d),ne(d))}},500))});const ne=i=>{console.log("scrollToComment called with commentId:",i);const d=document.getElementById(`comment-${i}`);console.log("Found element:",d),d?(console.log("Scrolling to comment element"),S.value=i,d.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{S.value=null},3e3)):(console.log("Comment element not found, available elements with comment- prefix:"),document.querySelectorAll('[id^="comment-"]').forEach(k=>console.log("Found comment element:",k.id)))};return z(()=>n.hash,i=>{if(i){if(i==="#comments"){setTimeout(()=>{const d=document.getElementById("comments");d&&(d.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{$.value&&$.value.focus()},300))},100);return}if(i.startsWith("#comment-")){const d=parseInt(i.replace("#comment-",""));d&&setTimeout(()=>{ne(d)},100)}}}),(i,d)=>(r(),c("div",So,[L.value?(r(),c("div",Bo,[d[1]||(d[1]=e("div",{class:"loading-spinner"},null,-1)),e("p",Vo,f(i.$t("common.loading")),1)])):h.value?(r(),c("div",Ho,[e("h1",Uo,f(i.$t("common.error")),1),e("p",No,f(h.value),1),e("button",{onClick:Z,class:"back-button"},f(i.$t("common.go_back")),1)])):T.value?(r(),c("div",Po,[K(Ke,{ref_key:"fullArticleCardRef",ref:D,article:T.value,onArticleDeleted:ie,onShareArticle:ae},null,8,["article"]),e("div",Oo,[e("h2",Fo,"Comments ("+f(N.value)+")",1),e("div",Zo,[le(e("textarea",{ref_key:"commentInput",ref:$,"onUpdate:modelValue":d[0]||(d[0]=a=>M.value=a),class:"comment-input",placeholder:"Write a comment...",rows:"3",onKeydown:Ue(G(J,["ctrl"]),["enter"])},null,40,Ko),[[$e,M.value]]),e("button",{class:"submit-comment-btn",onClick:J,disabled:!M.value.trim()}," Submit ",8,qo)]),e("div",zo,[(r(!0),c(se,null,Ie(E.value,a=>(r(),he(Eo,{key:a.id,comment:a,"highlighted-comment-id":S.value,"replying-to":x.value,onLike:W,onReact:ue,onReply:Q,onUserClick:me,onMentionClick:pe,onDelete:ve,onEdit:Y,onSubmitReply:ce,onCancelReply:X},null,8,["comment","highlighted-comment-id","replying-to"]))),128)),E.value.length===0?(r(),c("div",Wo,[...d[2]||(d[2]=[e("p",null,"Be the first to leave a comment!",-1)])])):y("",!0)])])])):(r(),c("div",Go,[e("h1",Jo,f(i.$t("common.article_not_found")),1),e("button",{onClick:Z,class:"back-button"},f(i.$t("common.go_back")),1)])),K(qe,{visible:B.value,"article-url":de.value,"article-title":j.value?.title||"",onClose:re},null,8,["visible","article-url","article-title"]),K(ke(De))]))}}),nn=we(Qo,[["__scopeId","data-v-aa5133ea"]]);export{nn as default};
