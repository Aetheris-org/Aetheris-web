import{a as B,r as C,d as D,u as j,G as E,k as M,T,A as N,i as k,l as P,j as s,t as f,s as g,B as I,y as V,R as $,E as w,_ as O}from"./index-Cha8mMNk.js";import{r as R,n as L,o as q,k as F,p as G,q as H,s as U,v as Z,w as z}from"./articles-Cl6OgbpY.js";const m=C([]),c=C(!1),i=C(null);function J(e,n=1400){if(!e)return"";const r=e.replace(/<[^>]+>/g,"");return r.length>n?r.slice(0,n).trimEnd():r}function p(){const e="anon_user_id";let n=localStorage.getItem(e);if(!n){const l=Date.now()%1e8+Math.floor(Math.random()*1e4);n=String(l),localStorage.setItem(e,n)}return Number(n)}function h(e){let n={id:0,username:"Anonymous"};return typeof e.author=="object"&&e.author!==null?n={id:e.author.id||e.author_id||0,username:e.author.username||"Anonymous",avatar:e.author.avatar||e.author_avatar||null}:typeof e.author=="string"&&(n={id:e.author_id||0,username:e.author,avatar:e.author_avatar||null}),{id:e.id,title:e.title,content:e.content,excerpt:e.excerpt||J(e.content),author:n,tags:Array.isArray(e.tags)?e.tags:typeof e.tags=="string"?e.tags.split(","):[],createdAt:e.createdAt||e.created_at||new Date().toISOString(),updatedAt:e.updatedAt||e.updated_at||void 0,status:e.status||"published",difficulty:e.difficulty||"medium",likes:e.likes??e.likes_count??0,dislikes:e.dislikes??e.dislikes_count??0,commentsCount:e.commentsCount??e.comments_count??0,userReaction:e.userReaction??e.user_reaction??null,previewImage:e.previewImage||e.preview_image||null,author_id:n.id||e.author_id||void 0}}function ce(){B();async function e(){c.value=!0,i.value=null;try{const o=p(),t=await z(o);m.value=t.map(h)}catch(o){i.value=o.message||"Ошибка загрузки"}finally{c.value=!1}}async function n(o){c.value=!0,i.value=null;try{const t=p(),a=await Z(o,t);m.value=a.map(h)}catch(t){i.value=t.message||"Ошибка поиска"}finally{c.value=!1}}async function r(o,t){try{const a=p(),d=await U(o,a,t),v=h(d),y=m.value.findIndex(S=>S.id===o);return y!==-1&&(m.value[y]=v),v}catch(a){throw console.error("Ошибка при реакции",a),a}}async function l(o){try{const t=p(),a=await H(o,t);return h(a)}catch(t){throw console.error("Ошибка при загрузке статьи",t),t}}async function _(o){try{c.value=!0,i.value=null;const t={...o},a=await G(t);console.log("API вернул article:",a);const d=h(a);return m.value.unshift(d),console.log("rawArticle из API:",d),d}catch(t){throw i.value=t.message||"Ошибка API при создании статьи",console.error(i.value),new Error(String(i.value))}finally{c.value=!1}}async function A(o,t){try{c.value=!0,i.value=null;const a=await F(o,t),d=h(a),v=m.value.findIndex(y=>y.id===o);return v!==-1&&(m.value[v]=d),d}catch(a){throw i.value=a.message||"Ошибка API при обновлении статьи",console.error(i.value),new Error(String(i.value))}finally{c.value=!1}}async function b(o){return p(),await q(o)}async function u(o,t,a){return await L(o,{text:t,parent_id:a??null})}async function x(o,t){return await R(o,t)}return{articles:m,loading:c,error:i,fetchArticles:e,searchArticles:n,react:r,getArticle:l,createArticle:_,updateArticle:A,fetchComments:b,addComment:u,reactCommentFn:x}}const K={class:"dialog-header"},Q={class:"dialog-title"},W={class:"dialog-subtitle"},X={class:"dialog-body"},Y={class:"dialog-message"},ee={class:"article-title"},te={class:"dialog-footer"},oe=["disabled"],ae=["disabled"],ne={key:0},se={key:1},ie=D({__name:"DeleteConfirmDialog",props:{visible:{type:Boolean},articleTitle:{},loading:{type:Boolean}},emits:["confirm","cancel"],setup(e,{emit:n}){const r=n,{t:l}=j(),_=()=>{r("confirm")},A=()=>{r("cancel")};return(b,u)=>(w(),E($,{to:"body"},[M(T,{name:"dialog-fade"},{default:N(()=>[e.visible?(w(),k("div",{key:0,class:"dialog-overlay",onClick:A},[s("div",{class:"dialog-content",onClick:u[0]||(u[0]=V(()=>{},["stop"]))},[s("div",K,[u[1]||(u[1]=s("div",{class:"warning-icon"},[s("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M12 9v4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),s("path",{d:"M12 17h.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),s("path",{d:"M10.29 3.86L1.82 18c-.175.302-.267.645-.268.994-.001.35.089.693.262.997.173.303.423.556.724.733.3.177.642.272.991.276H20.47c.349-.004.691-.099.992-.276.301-.177.55-.43.723-.733.173-.304.263-.647.262-.997-.001-.349-.093-.692-.268-.994L13.71 3.86A2.5 2.5 0 0 0 12 2.897a2.5 2.5 0 0 0-1.71.963Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),s("h3",Q,f(g(l)("notifications.deleteArticle.title")),1),s("p",W,f(g(l)("notifications.deleteArticle.subtitle")),1)]),s("div",X,[s("p",Y,[I(f(g(l)("notifications.deleteArticle.message"))+" ",1),s("span",ee,'"'+f(e.articleTitle)+'"',1),u[2]||(u[2]=I("? ",-1))])]),s("div",te,[s("button",{class:"dialog-button cancel",onClick:A,disabled:e.loading},f(g(l)("notifications.deleteArticle.cancel")),9,oe),s("button",{class:"dialog-button delete",onClick:_,disabled:e.loading},[e.loading?(w(),k("span",ne,f(g(l)("notifications.deleteArticle.deleting")),1)):(w(),k("span",se,f(g(l)("notifications.deleteArticle.confirm")),1))],8,ae)])])])):P("",!0)]),_:1})]))}}),ue=O(ie,[["__scopeId","data-v-ad2c7936"]]);export{ue as D,ce as u};
