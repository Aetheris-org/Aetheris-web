import{Q as r,aG as u,aH as o,aC as d,aB as c,aI as p}from"./index-Cha8mMNk.js";function s(e){const a=p(e.author);return{id:e.id,title:e.title,content:e.content,excerpt:e.excerpt||void 0,author:{id:a?.id||0,username:a?.username||"Anonymous",avatar:a?.avatar||null},author_id:a?.id,author_avatar:a?.avatar,tags:Array.isArray(e.tags)?e.tags:[],preview_image:d(e.preview_image),previewImage:d(e.preview_image),status:e.publishedAt?"published":"draft",difficulty:e.difficulty||"medium",likes:e.likes_count||0,dislikes:e.dislikes_count||0,comments_count:e.comments_count||0,commentsCount:e.comments_count||0,created_at:e.createdAt||e.created_at,createdAt:e.createdAt||e.created_at,updatedAt:e.updatedAt||e.updated_at,user_reaction:e.user_reaction||null,userReaction:e.user_reaction||null}}async function _(e){const a=await r.get("/api/articles",{params:{populate:{author:{fields:["id","username"],populate:{avatar:{fields:["url"]}}},preview_image:{fields:["url"]}},"filters[publishedAt][$notNull]":!0}});return u(a.data).map(s)}async function w(e,a,t=0,i=100){const n=await r.get("/api/articles/search",{params:{q:e,skip:t,limit:i}});return u(n.data).map(s)}async function v(e,a=3){const t=await r.get("/api/articles",{params:{populate:{author:{fields:["id","username"],populate:{avatar:{fields:["url"]}}},preview_image:{fields:["url"]}},"filters[publishedAt][$notNull]":!0,"pagination[limit]":a,"sort[0]":"createdAt:desc"}});return u(t.data).map(s)}async function m(e,a){const t=await r.get(`/api/articles/${e}`,{params:{populate:{author:{fields:["id","username"],populate:{avatar:{fields:["url"]}}},preview_image:{fields:["url"]}}}});return s(o(t.data))}async function h(e,a,t){const i=await r.post(`/api/articles/${e}/react`,{reaction:t});return s(i.data.data)}async function y(e){const a={title:e.title,content:e.content,excerpt:e.excerpt||void 0,tags:e.tags,difficulty:e.difficulty,publishedAt:e.status==="published"?new Date().toISOString():null};e.preview_image&&(typeof e.preview_image=="number"||!isNaN(Number(e.preview_image))?a.preview_image=Number(e.preview_image):a.preview_image=e.preview_image),console.log("ðŸ“¤ Sending article data to Strapi:",JSON.stringify(a,null,2));const t=await r.post("/api/articles",c(a));return s(o(t.data))}async function b(e,a){const t={title:a.title,content:a.content,excerpt:a.excerpt||void 0,tags:a.tags,difficulty:a.difficulty,publishedAt:a.status==="published"?new Date().toISOString():null};a.preview_image&&(typeof a.preview_image=="number"||!isNaN(Number(a.preview_image))?t.preview_image=Number(a.preview_image):t.preview_image=a.preview_image),console.log("ðŸ“¤ Updating article data in Strapi:",JSON.stringify(t,null,2));const i=await r.put(`/api/articles/${e}`,c(t));return s(o(i.data))}async function k(e){await r.delete(`/api/articles/${e}`)}function l(e){const a=p(e.author),t=a?.id??e.author_id??null,i=a?.username??e.author_name??"Guest",n=a?.avatar??e.author_avatar??null;return{id:e.id,article_id:e.article?.data?.id||e.article?.id,parent_id:e.parent?.data?.id||e.parent?.id||null,author_id:t,author_name:i,author_avatar:n,text:e.text,created_at:e.createdAt||e.created_at,updated_at:e.updated_at_custom||e.updatedAt||e.updated_at,likes:e.likes_count||0,dislikes:e.dislikes_count||0,user_reaction:e.user_reaction||null}}async function S(e,a){const t=await r.get("/api/comments",{params:{"filters[article][id][$eq]":e,populate:{author:{fields:["id","username"],populate:{avatar:{fields:["url"]}}},parent:{fields:["id"]}}}});try{const n=(t.data?.data||[]).slice(0,3);console.warn("ðŸ”µ getArticleComments raw sample:",n)}catch{}const i=u(t.data).map(l);try{console.warn("ðŸ”µ getArticleComments mapped sample:",i.slice(0,3))}catch{}return i}async function I(e,a){const t=await r.post("/api/comments",c({text:a.text,article:e,parent:a.parent_id||null}));return l(o(t.data))}async function A(e,a){const t=await r.post(`/api/comments/${e}/react`,{reaction:a});return l(t.data.data)}async function $(e,a){const t=await r.put(`/api/comments/${e}`,c({text:a,updated_at_custom:new Date().toISOString()}));return l(o(t.data))}async function N(e,a){await r.delete(`/api/comments/${e}`)}async function f(){return{articles_count:(await r.get("/api/articles",{params:{"filters[author][id][$eq]":"$USER_ID",pagination:{limit:1}}})).data.meta?.pagination?.total||0,comments_count:0,join_date:new Date().toISOString()}}async function x(e=0,a=100){const t=await r.get("/api/articles",{params:{populate:{author:{fields:["id","username"],populate:{avatar:{fields:["url"]}}},preview_image:{fields:["url"]}},pagination:{start:e,limit:a}}});return u(t.data).map(s)}async function D(e){return m(e)}async function U(e){const a=await r.get(`/api/users/${e}`,{params:{populate:{avatar:{fields:["url"]}}}}),t=o(a.data);return{id:t.id,username:t.username,avatar:d(t.avatar),created_at:t.createdAt||t.created_at}}async function R(e){return f()}async function O(e,a=0,t=100,i){const n=await r.get("/api/articles",{params:{"filters[author][id][$eq]":e,"filters[publishedAt][$notNull]":!0,populate:{author:{fields:["id","username"],populate:{avatar:{fields:["url"]}}},preview_image:{fields:["url"]}},pagination:{start:a,limit:t}}});return u(n.data).map(s)}async function P(){return[]}async function q(){return[]}async function B(){return[]}async function E(e){return(await r.post(`/api/articles/${e}/bookmark`)).data.data}async function F(e){return(await r.get(`/api/articles/${e}/bookmark`)).data.data}async function j(e=0,a=100){const t=await r.get("/api/articles/bookmarked",{params:{skip:e,limit:a}});return u(t.data).map(s)}async function G(e){const a=new FormData;a.append("files",e);const i=(await r.post("/api/upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data[0];if(!i||!i.id)throw new Error("Upload failed: no file ID returned");return i.id}export{N as a,x as b,O as c,k as d,f as e,R as f,v as g,U as h,G as i,D as j,b as k,F as l,j as m,I as n,S as o,y as p,m as q,A as r,h as s,E as t,$ as u,w as v,_ as w,P as x,q as y,B as z};
