# üì¶ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase Storage –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞:
–°—Ç–∞—Ä—ã–π –±—ç–∫–µ–Ω–¥ –Ω–∞ Render –±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—ç—Ç–æ–º—É –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ `/upload/img` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ:
–ò—Å–ø–æ–ª—å–∑—É–µ–º Supabase Storage –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞:

### 1. –°–æ–∑–¥–∞—Ç—å Storage Bucket

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://app.supabase.com)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Storage**
4. –ù–∞–∂–º–∏—Ç–µ **Create bucket**
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
   - **Name:** `images`
   - **Public bucket:** ‚úÖ (—á—Ç–æ–±—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø—É–±–ª–∏—á–Ω–æ)
   - **File size limit:** 5MB (–∏–ª–∏ –±–æ–ª—å—à–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - **Allowed MIME types:** `image/*` (–∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã: `image/jpeg,image/png,image/webp`)

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å RLS Policies

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è bucket –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞:

```sql
-- –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ–º —á–∏—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
CREATE POLICY "Public Access"
ON storage.objects FOR SELECT
USING (bucket_id = 'images');

-- –†–∞–∑—Ä–µ—à–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
CREATE POLICY "Authenticated users can upload"
ON storage.objects FOR INSERT
WITH CHECK (
  bucket_id = 'images' 
  AND auth.role() = 'authenticated'
);

-- –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —É–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
CREATE POLICY "Users can delete own images"
ON storage.objects FOR DELETE
USING (
  bucket_id = 'images' 
  AND auth.uid()::text = (storage.foldername(name))[1]
);
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ Supabase Dashboard:**
1. Storage ‚Üí `images` bucket ‚Üí Policies
2. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏:
   - **SELECT:** Public (–≤—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å)
   - **INSERT:** Authenticated (—Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å)
   - **DELETE:** Custom (—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ñ–∞–π–ª—ã)

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫:

–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:
```
images/
  ‚îú‚îÄ‚îÄ avatars/
  ‚îÇ   ‚îî‚îÄ‚îÄ {user-id}/
  ‚îÇ       ‚îî‚îÄ‚îÄ {timestamp}-{random}.jpg
  ‚îú‚îÄ‚îÄ covers/
  ‚îÇ   ‚îî‚îÄ‚îÄ {user-id}/
  ‚îÇ       ‚îî‚îÄ‚îÄ {timestamp}-{random}.jpg
  ‚îî‚îÄ‚îÄ articles/
      ‚îî‚îÄ‚îÄ {user-id}/
          ‚îî‚îÄ‚îÄ {timestamp}-{random}.jpg
```

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞:

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è
2. –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–ª–æ–∂–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
3. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—å–∏

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

- Bucket –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–ø—É–±–ª–∏—á–Ω—ã–º** –¥–ª—è —á—Ç–µ–Ω–∏—è
- RLS –¥–æ–ª–∂–µ–Ω —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ç–æ–ª—å–∫–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ñ–∞–π–ª—ã

## üîç Troubleshooting:

–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ bucket `images` —Å–æ–∑–¥–∞–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS policies
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

