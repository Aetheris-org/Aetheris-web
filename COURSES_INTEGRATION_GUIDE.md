# üéì –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∫—É—Ä—Å–æ–≤ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ Strapi](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-strapi)
3. [API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã](#api-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
4. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º)
5. [–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏](#—Å–∏—Å—Ç–µ–º–∞-–º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏)
6. [–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—è](#–ø—Ä–∞–≤–∞-–¥–æ—Å—Ç—É–ø–∞-–∏-—Ä–µ–ø—É—Ç–∞—Ü–∏—è)
7. [–ß–µ–∫–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏](#—á–µ–∫–ª–∏—Å—Ç-–º–∏–≥—Ä–∞—Ü–∏–∏)

---

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –∫—É—Ä—Å–æ–≤ Aetheris –≤–∫–ª—é—á–∞–µ—Ç:
- **–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã** - –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π, –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- **–ö—É—Ä—Å—ã –æ—Ç —Å–æ–æ–±—â–µ—Å—Ç–≤–∞** - —Å–æ–∑–¥–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π —Ä–µ–ø—É—Ç–∞—Ü–∏–µ–π
- **–†–æ–∞–¥–º–∞–ø –∫—É—Ä—Å–∞** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ –∏ —É—Ä–æ–∫–∞–º–∏
- **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤
- **–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è** - –ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã, –ø–æ–¥–ø–∏—Å–∫–∏, —Ä–µ–∫–ª–∞–º–∞, –¥–æ—Å—Ç—É–ø –ø–æ —É—Ä–æ–≤–Ω—é
- **–û—Ç–∑—ã–≤—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏** - –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Strapi

### 1. Content Type: `Course`

```typescript
{
  title: string (required, unique)
  slug: string (required, unique, auto-generated from title)
  description: text (required)
  shortDescription: string (required, max 200 chars)
  thumbnail: media (single image)
  coverImage: media (single image)
  
  // Relations
  author: relation (User, many-to-one)
  sections: relation (CourseSection, one-to-many)
  category: relation (CourseCategory, many-to-one)
  
  // Verification
  isVerified: boolean (default: false)
  verificationDate: datetime
  moderatorNotes: text
  
  // Content
  totalLessons: number (computed)
  totalDuration: number (in minutes, computed)
  tags: json (array of strings)
  level: enumeration ['beginner', 'intermediate', 'advanced', 'expert']
  language: string (default: 'ru')
  
  // Access & Pricing
  pricingType: enumeration ['free', 'paid', 'subscription', 'level-gated']
  price: decimal (nullable, for 'paid' type)
  currency: enumeration ['USD', 'EUR', 'RUB'] (default: 'USD')
  requiredTier: enumeration ['basic', 'premium', 'pro'] (nullable, for 'subscription')
  requiredLevel: number (nullable, for 'level-gated')
  hasAds: boolean (default: false)
  adRevenueEnabled: boolean (default: false)
  estimatedCPM: decimal (nullable)
  
  // Stats (updated via hooks/cron)
  enrolledStudents: number (default: 0)
  completionRate: number (default: 0)
  averageRating: decimal (default: 0)
  totalReviews: number (default: 0)
  totalRevenue: decimal (default: 0)
  viewCount: number (default: 0)
  
  // Learning
  learningOutcomes: json (array of strings)
  prerequisites: json (array of strings)
  providesCertificate: boolean (default: false)
  certificateTemplate: string (nullable)
  
  // Status
  status: enumeration ['draft', 'published', 'archived', 'under-review'] (default: 'draft')
  publishedAt: datetime (nullable)
  
  // Timestamps
  createdAt: datetime (auto)
  updatedAt: datetime (auto)
}
```

**Hooks –¥–ª—è Course:**
- `beforeCreate`: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –∞–≤—Ç–æ—Ä–∞ (min 100) –∏ —É—Ä–æ–≤–Ω—è (min 5)
- `beforeUpdate`: –ü–µ—Ä–µ—Å—á–µ—Ç totalLessons –∏ totalDuration –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ sections
- `afterCreate`: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `afterUpdate`: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

---

### 2. Content Type: `CourseSection`

```typescript
{
  title: string (required)
  description: text (required)
  order: number (required)
  estimatedDuration: number (in minutes, computed from lessons)
  
  // Relations
  course: relation (Course, many-to-one)
  lessons: relation (CourseLesson, one-to-many)
  
  // Access
  isLocked: boolean (default: false)
  
  // Timestamps
  createdAt: datetime (auto)
  updatedAt: datetime (auto)
}
```

**Hooks –¥–ª—è CourseSection:**
- `beforeUpdate`: –ü–µ—Ä–µ—Å—á–µ—Ç estimatedDuration –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ lessons
- `afterCreate/afterUpdate/afterDelete`: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ totalLessons –∏ totalDuration –≤ Course

---

### 3. Content Type: `CourseLesson`

```typescript
{
  title: string (required)
  description: text (required)
  duration: number (required, in minutes)
  type: enumeration ['video', 'article', 'interactive', 'quiz', 'assignment'] (required)
  order: number (required)
  
  // Content
  content: richtext (nullable, for 'article' type)
  videoUrl: string (nullable, for 'video' type)
  videoProvider: enumeration ['youtube', 'vimeo', 'custom'] (nullable)
  attachments: media (multiple files)
  
  // Access
  isPreview: boolean (default: false) // Can be viewed without enrollment
  
  // Relations
  section: relation (CourseSection, many-to-one)
  
  // Timestamps
  createdAt: datetime (auto)
  updatedAt: datetime (auto)
}
```

---

### 4. Content Type: `CourseEnrollment`

```typescript
{
  // Relations
  user: relation (User, many-to-one)
  course: relation (Course, many-to-one)
  
  // Progress
  completedLessons: json (array of lesson IDs)
  currentSection: string (section ID)
  currentLesson: string (lesson ID)
  overallProgress: number (percentage, computed)
  
  // Certificate
  certificateIssued: boolean (default: false)
  certificateIssuedAt: datetime (nullable)
  certificateId: string (nullable, unique)
  certificateUrl: string (nullable)
  
  // Timestamps
  enrolledAt: datetime (auto, on create)
  lastAccessedAt: datetime (updated on lesson view)
  createdAt: datetime (auto)
  updatedAt: datetime (auto)
}
```

**Unique constraint:** `user` + `course` (one enrollment per user per course)

**Hooks –¥–ª—è CourseEnrollment:**
- `beforeCreate`: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (pricing, level, subscription)
- `afterCreate`: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ enrolledStudents –≤ Course
- `beforeUpdate`: –ü–µ—Ä–µ—Å—á–µ—Ç overallProgress, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ (100%) –¥–ª—è –≤—ã–¥–∞—á–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

---

### 5. Content Type: `CourseReview`

```typescript
{
  // Relations
  user: relation (User, many-to-one)
  course: relation (Course, many-to-one)
  
  // Review
  rating: number (required, min: 1, max: 5)
  comment: text (required, min: 10 chars)
  helpful: number (default: 0) // Number of "helpful" votes
  courseProgress: number (percentage at time of review)
  
  // Timestamps
  createdAt: datetime (auto)
  updatedAt: datetime (auto)
}
```

**Unique constraint:** `user` + `course` (one review per user per course)

**Hooks –¥–ª—è CourseReview:**
- `afterCreate/afterUpdate/afterDelete`: –ü–µ—Ä–µ—Å—á–µ—Ç averageRating –∏ totalReviews –≤ Course

---

### 6. Content Type: `CourseCategory`

```typescript
{
  name: string (required, unique)
  slug: string (required, unique)
  description: text
  icon: string (Lucide icon name)
  courseCount: number (computed)
  
  // Relations
  courses: relation (Course, one-to-many)
  
  // Timestamps
  createdAt: datetime (auto)
  updatedAt: datetime (auto)
}
```

---

### 7. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ User Content Type

–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π User:

```typescript
{
  // ... existing fields
  
  // Course-related
  reputation: number (default: 0)
  level: number (default: 1)
  canCreateCourses: boolean (computed: reputation >= 100 && level >= 5)
  
  // Relations
  createdCourses: relation (Course, one-to-many, field: 'author')
  enrollments: relation (CourseEnrollment, one-to-many)
  reviews: relation (CourseReview, one-to-many)
}
```

---

## üîå API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### Courses

```typescript
// GET /api/courses
// Query params: filters, sort, pagination
// Returns: { data: Course[], meta: { pagination } }

// GET /api/courses/:slug
// Populate: author, sections.lessons, category
// Returns: { data: Course }

// POST /api/courses
// Body: Partial<Course>
// Auth: Required, check reputation & level
// Returns: { data: Course }

// PUT /api/courses/:id
// Body: Partial<Course>
// Auth: Required, author only or admin
// Returns: { data: Course }

// DELETE /api/courses/:id
// Auth: Required, author only or admin
// Returns: { data: Course }

// POST /api/courses/:id/verify
// Auth: Required, moderator/admin only
// Body: { moderatorNotes?: string }
// Returns: { data: Course }
```

### Enrollments

```typescript
// POST /api/courses/:id/enroll
// Auth: Required
// Check: pricing, level, subscription
// Returns: { data: CourseEnrollment }

// GET /api/courses/:id/progress
// Auth: Required
// Returns: { data: CourseEnrollment }

// PUT /api/courses/:id/progress
// Auth: Required
// Body: { lessonId: string, completed: boolean }
// Returns: { data: CourseEnrollment }
```

### Reviews

```typescript
// POST /api/courses/:id/reviews
// Auth: Required, must be enrolled
// Body: { rating: number, comment: string }
// Returns: { data: CourseReview }

// PUT /api/reviews/:id
// Auth: Required, author only
// Body: { rating?: number, comment?: string }
// Returns: { data: CourseReview }

// DELETE /api/reviews/:id
// Auth: Required, author only or admin
// Returns: { data: CourseReview }

// POST /api/reviews/:id/helpful
// Auth: Required
// Toggle helpful vote
// Returns: { data: CourseReview }
```

### Categories

```typescript
// GET /api/course-categories
// Returns: { data: CourseCategory[] }
```

---

## üé® –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

### 1. –°–æ–∑–¥–∞—Ç—å API –∫–ª–∏–µ–Ω—Ç

**–§–∞–π–ª:** `frontend-react/src/api/courses.ts`

```typescript
import { api } from './client'
import type { Course, CourseFilters, CourseEnrollment, CourseReview } from '@/types/courses'

export const coursesApi = {
  // Get all courses with filters
  getCourses: async (filters?: CourseFilters) => {
    const params = new URLSearchParams()
    if (filters?.category) params.append('filters[category][name][$eq]', filters.category)
    if (filters?.level) params.append('filters[level][$eq]', filters.level)
    if (filters?.verified !== undefined) params.append('filters[isVerified][$eq]', String(filters.verified))
    if (filters?.pricing) params.append('filters[pricingType][$eq]', filters.pricing)
    if (filters?.search) params.append('filters[$or][0][title][$containsi]', filters.search)
    if (filters?.minRating) params.append('filters[averageRating][$gte]', String(filters.minRating))
    
    // Sorting
    const sortMap = {
      popular: 'enrolledStudents:desc',
      newest: 'publishedAt:desc',
      rating: 'averageRating:desc',
      trending: 'viewCount:desc',
    }
    if (filters?.sortBy) params.append('sort', sortMap[filters.sortBy])
    
    params.append('populate', 'author,category')
    
    const response = await api.get(`/courses?${params.toString()}`)
    return response.data
  },

  // Get single course by slug
  getCourse: async (slug: string) => {
    const response = await api.get(`/courses/${slug}?populate=author,sections.lessons,category`)
    return response.data.data as Course
  },

  // Create course
  createCourse: async (data: Partial<Course>) => {
    const response = await api.post('/courses', { data })
    return response.data.data as Course
  },

  // Update course
  updateCourse: async (id: string, data: Partial<Course>) => {
    const response = await api.put(`/courses/${id}`, { data })
    return response.data.data as Course
  },

  // Enroll in course
  enrollInCourse: async (courseId: string) => {
    const response = await api.post(`/courses/${courseId}/enroll`)
    return response.data.data as CourseEnrollment
  },

  // Get user progress
  getProgress: async (courseId: string) => {
    const response = await api.get(`/courses/${courseId}/progress`)
    return response.data.data as CourseEnrollment
  },

  // Update lesson progress
  updateProgress: async (courseId: string, lessonId: string, completed: boolean) => {
    const response = await api.put(`/courses/${courseId}/progress`, {
      lessonId,
      completed,
    })
    return response.data.data as CourseEnrollment
  },

  // Add review
  addReview: async (courseId: string, rating: number, comment: string) => {
    const response = await api.post(`/courses/${courseId}/reviews`, {
      data: { rating, comment },
    })
    return response.data.data as CourseReview
  },

  // Get categories
  getCategories: async () => {
    const response = await api.get('/course-categories')
    return response.data.data
  },
}
```

---

### 2. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

**–§–∞–π–ª:** `frontend-react/src/pages/CoursesPage.tsx`

–ó–∞–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç –º–æ–∫-–¥–∞–Ω–Ω—ã—Ö:

```typescript
// ‚ùå –£–¥–∞–ª–∏—Ç—å
import { mockCourses, mockCategories } from '@/data/coursesMockData'

// ‚úÖ –î–æ–±–∞–≤–∏—Ç—å
import { useQuery } from '@tanstack/react-query'
import { coursesApi } from '@/api/courses'
import { Skeleton } from '@/components/ui/skeleton'
```

–ó–∞–º–µ–Ω–∏—Ç—å useState –Ω–∞ useQuery:

```typescript
// ‚ùå –£–¥–∞–ª–∏—Ç—å
const filteredCourses = useMemo(() => {
  return mockCourses.filter(...)
}, [filters])

// ‚úÖ –î–æ–±–∞–≤–∏—Ç—å
const { data: courses, isLoading } = useQuery({
  queryKey: ['courses', filters],
  queryFn: () => coursesApi.getCourses(filters),
})

// –î–æ–±–∞–≤–∏—Ç—å loading state
if (isLoading) {
  return <CoursesPageSkeleton />
}
```

---

### 3. –î–æ–±–∞–≤–∏—Ç—å Skeleton –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–§–∞–π–ª:** `frontend-react/src/components/skeletons/CoursesPageSkeleton.tsx`

```typescript
export function CoursesPageSkeleton() {
  return (
    <div className="container py-8 space-y-8">
      <Skeleton className="h-64 w-full rounded-3xl" />
      <Skeleton className="h-48 w-full rounded-lg" />
      <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {Array.from({ length: 6 }).map((_, i) => (
          <Skeleton key={i} className="h-96 w-full rounded-lg" />
        ))}
      </div>
    </div>
  )
}
```

---

### 4. –û–±–Ω–æ–≤–∏—Ç—å CourseDetailPage

```typescript
// –í CourseDetailPage.tsx
const { data: course, isLoading } = useQuery({
  queryKey: ['course', slug],
  queryFn: () => coursesApi.getCourse(slug!),
  enabled: !!slug,
})

const { data: enrollment } = useQuery({
  queryKey: ['enrollment', course?.id],
  queryFn: () => coursesApi.getProgress(course!.id),
  enabled: !!course && isEnrolled,
})

// –î–æ–±–∞–≤–∏—Ç—å mutation –¥–ª—è enrollment
const enrollMutation = useMutation({
  mutationFn: (courseId: string) => coursesApi.enrollInCourse(courseId),
  onSuccess: () => {
    queryClient.invalidateQueries(['enrollment', course?.id])
    toast.success('–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –∫—É—Ä—Å!')
  },
})
```

---

## üí∞ –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Stripe (–¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤)

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
npm install @stripe/stripe-js @stripe/react-stripe-js
```

**–°–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ Strapi:**
```typescript
// backend/src/api/course/controllers/payment.ts
export default {
  async createCheckoutSession(ctx) {
    const { courseId } = ctx.request.body
    const course = await strapi.entityService.findOne('api::course.course', courseId)
    
    if (course.pricingType !== 'paid') {
      return ctx.badRequest('Course is not paid')
    }
    
    const session = await stripe.checkout.sessions.create({
      payment_method_types: ['card'],
      line_items: [{
        price_data: {
          currency: course.currency.toLowerCase(),
          product_data: {
            name: course.title,
            description: course.shortDescription,
          },
          unit_amount: Math.round(course.price * 100),
        },
        quantity: 1,
      }],
      mode: 'payment',
      success_url: `${process.env.FRONTEND_URL}/courses/${course.slug}?payment=success`,
      cancel_url: `${process.env.FRONTEND_URL}/courses/${course.slug}?payment=cancelled`,
      metadata: {
        courseId: course.id,
        userId: ctx.state.user.id,
      },
    })
    
    return { sessionId: session.id }
  },
  
  async handleWebhook(ctx) {
    const sig = ctx.request.headers['stripe-signature']
    const event = stripe.webhooks.constructEvent(ctx.request.body, sig, process.env.STRIPE_WEBHOOK_SECRET)
    
    if (event.type === 'checkout.session.completed') {
      const session = event.data.object
      const { courseId, userId } = session.metadata
      
      // Create enrollment
      await strapi.entityService.create('api::course-enrollment.course-enrollment', {
        data: {
          user: userId,
          course: courseId,
          enrolledAt: new Date(),
        },
      })
    }
    
    return { received: true }
  },
}
```

---

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏

**–í Strapi middleware:**
```typescript
// backend/src/middlewares/checkSubscription.ts
export default (config, { strapi }) => {
  return async (ctx, next) => {
    if (ctx.state.user) {
      const user = await strapi.entityService.findOne(
        'plugin::users-permissions.user',
        ctx.state.user.id,
        { populate: ['subscription'] }
      )
      
      ctx.state.user.subscriptionTier = user.subscription?.tier || null
      ctx.state.user.subscriptionActive = user.subscription?.active || false
    }
    
    await next()
  }
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ enrollment:**
```typescript
// –í beforeCreate hook CourseEnrollment
if (course.pricingType === 'subscription') {
  const userTier = ctx.state.user.subscriptionTier
  const requiredTier = course.requiredTier
  
  const tierHierarchy = ['basic', 'premium', 'pro']
  const userTierIndex = tierHierarchy.indexOf(userTier)
  const requiredTierIndex = tierHierarchy.indexOf(requiredTier)
  
  if (userTierIndex < requiredTierIndex) {
    throw new Error(`–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞ —É—Ä–æ–≤–Ω—è ${requiredTier}`)
  }
}
```

---

### 3. –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–ª–∞–º—ã

**Google AdSense –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**

```typescript
// frontend-react/src/components/CourseAd.tsx
export function CourseAd({ course }: { course: Course }) {
  useEffect(() => {
    if (course.access.hasAds && course.access.adRevenue?.enabled) {
      // Load AdSense script
      const script = document.createElement('script')
      script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js'
      script.async = true
      document.head.appendChild(script)
      
      // Track ad impression for revenue
      coursesApi.trackAdImpression(course.id)
    }
  }, [course])
  
  if (!course.access.hasAds) return null
  
  return (
    <div className="my-8">
      <ins
        className="adsbygoogle"
        style={{ display: 'block' }}
        data-ad-client="ca-pub-XXXXXXXXXX"
        data-ad-slot="XXXXXXXXXX"
        data-ad-format="auto"
      />
    </div>
  )
}
```

**–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–æ—Ö–æ–¥–∞ –≤ Strapi:**
```typescript
// backend/src/api/course/controllers/analytics.ts
export default {
  async trackAdImpression(ctx) {
    const { courseId } = ctx.request.body
    const course = await strapi.entityService.findOne('api::course.course', courseId)
    
    // Increment view count
    await strapi.entityService.update('api::course.course', courseId, {
      data: {
        viewCount: course.viewCount + 1,
      },
    })
    
    // Calculate revenue (CPM = cost per 1000 impressions)
    if (course.adRevenueEnabled && course.estimatedCPM) {
      const revenuePerView = course.estimatedCPM / 1000
      await strapi.entityService.update('api::course.course', courseId, {
        data: {
          totalRevenue: course.totalRevenue + revenuePerView,
        },
      })
    }
    
    return { success: true }
  },
}
```

---

## üîê –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫—É—Ä—Å–∞

**–í Strapi controller:**
```typescript
// backend/src/api/course/controllers/course.ts
export default {
  async create(ctx) {
    const user = ctx.state.user
    
    // Check reputation and level
    if (user.reputation < 100 || user.level < 5) {
      return ctx.forbidden('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –∏–ª–∏ —É—Ä–æ–≤–Ω—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫—É—Ä—Å–∞')
    }
    
    // Create course
    const course = await strapi.entityService.create('api::course.course', {
      data: {
        ...ctx.request.body.data,
        author: user.id,
        status: 'draft',
        isVerified: false,
      },
    })
    
    return course
  },
}
```

---

### 2. –°–∏—Å—Ç–µ–º–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏

**–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏:**
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫—É—Ä—Å–∞: +10
- –û—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞: +5
- –ü–æ–ª–µ–∑–Ω—ã–π –æ—Ç–∑—ã–≤ (helpful): +2 –∞–≤—Ç–æ—Ä—É –æ—Ç–∑—ã–≤–∞
- –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞: +50
- –°—Ç—É–¥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏–ª –≤–∞—à –∫—É—Ä—Å: +3 –∞–≤—Ç–æ—Ä—É –∫—É—Ä—Å–∞

**–í Strapi hooks:**
```typescript
// backend/src/api/course-enrollment/lifecycles.ts
export default {
  async afterUpdate(event) {
    const { result, params } = event
    
    // Check if course was just completed
    if (result.overallProgress === 100 && params.data.overallProgress !== 100) {
      // Award reputation to student
      await strapi.entityService.update(
        'plugin::users-permissions.user',
        result.user.id,
        { data: { reputation: result.user.reputation + 10 } }
      )
      
      // Award reputation to course author
      const course = await strapi.entityService.findOne('api::course.course', result.course.id, {
        populate: ['author'],
      })
      await strapi.entityService.update(
        'plugin::users-permissions.user',
        course.author.id,
        { data: { reputation: course.author.reputation + 3 } }
      )
    }
  },
}
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

### Backend (Strapi)

- [ ] –°–æ–∑–¥–∞—Ç—å –≤—Å–µ Content Types (Course, CourseSection, CourseLesson, CourseEnrollment, CourseReview, CourseCategory)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ User (reputation, level, canCreateCourses)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å relations –º–µ–∂–¥—É Content Types
- [ ] –°–æ–∑–¥–∞—Ç—å hooks –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (totalLessons, averageRating, etc.)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å permissions –¥–ª—è –∫–∞–∂–¥–æ–≥–æ Content Type
- [ ] –°–æ–∑–¥–∞—Ç—å custom controllers –¥–ª—è enrollment, progress, reviews
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Stripe –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –¥–ª—è Stripe
- [ ] –°–æ–∑–¥–∞—Ç—å middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ (hooks)
- [ ] –°–æ–∑–¥–∞—Ç—å cron job –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫—É—Ä—Å–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–Ω–æ–≤—ã–π –∫—É—Ä—Å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è, etc.)

### Frontend (React)

- [ ] –°–æ–∑–¥–∞—Ç—å `src/api/courses.ts` —Å API –∫–ª–∏–µ–Ω—Ç–æ–º
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `CoursesPage.tsx` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è useQuery
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `CourseDetailPage.tsx` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è useQuery
- [ ] –°–æ–∑–¥–∞—Ç—å Skeleton –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è loading states
- [ ] –î–æ–±–∞–≤–∏—Ç—å error handling –∏ toast notifications
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–∑–¥–∞–Ω–∏—è –∫—É—Ä—Å–∞ (`CourseCreatePage.tsx`)
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—É—Ä—Å–∞ (`CourseEditPage.tsx`)
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±—É—á–µ–Ω–∏—è (`CourseLearningPage.tsx`) –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —É—Ä–æ–∫–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Stripe Checkout –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–∫–ª–∞–º—ã (`CourseAd.tsx`)
- [ ] –°–æ–∑–¥–∞—Ç—å dashboard –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤ –∫—É—Ä—Å–æ–≤ (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –¥–æ—Ö–æ–¥)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ú–æ–∏ –∫—É—Ä—Å—ã" (enrolled courses)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –æ—Ç–∑—ã–≤–æ–≤ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, helpful votes)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –∫—É—Ä—Å–æ–≤
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### Testing

- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è API functions
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å integration —Ç–µ—Å—Ç—ã –¥–ª—è enrollment flow
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å payment flow (Stripe)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (reputation, level, subscription)
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ flow (–æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—É—Ä—Å–∞)

### Deployment

- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å environment variables –¥–ª—è Stripe
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook URL –¥–ª—è Stripe –≤ production
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å AdSense account –∏ –ø–æ–ª—É—á–∏—Ç—å publisher ID
- [ ] –°–æ–∑–¥–∞—Ç—å backup strategy –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å monitoring –∏ logging
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ load testing –¥–ª—è API endpoints
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å database queries (indexes)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CDN –¥–ª—è media files (thumbnails, videos)

### Cleanup

- [ ] –£–¥–∞–ª–∏—Ç—å `frontend-react/src/data/coursesMockData.ts`
- [ ] –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã mock data –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [ ] –£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª (`COURSES_INTEGRATION_GUIDE.md`) –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Strapi Documentation](https://docs.strapi.io/)
- [React Query Documentation](https://tanstack.com/query/latest)
- [Stripe Documentation](https://stripe.com/docs)
- [shadcn/ui Components](https://ui.shadcn.com/)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-02-20

**–ê–≤—Ç–æ—Ä:** AI Assistant (Claude Sonnet 4.5)

**–í–µ—Ä—Å–∏—è:** 1.0.0

